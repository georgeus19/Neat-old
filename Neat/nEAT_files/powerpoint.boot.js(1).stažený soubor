"use strict";function getLogger(n,t){var i=new bUlsCache(n,t);return{ULS:{trace:function(n,t,r){return traceTagImpl(i,0,n,t,r)},traceTag:function(n,t,r,u){return traceTagImpl(i,n,t,r,u)},flush:i.flush,flushOnClose:i.flushOnClose}}}function traceTagImpl(n,t,i,r,u){if(!(r>currentLevel)){var f={timestamp:Date.now(),category:i,tag:t,level:r,type:logType.Trace,message:u};n.handleTrace(f)}}function formatForUpload(n,t,i,r){var u=n.map(function(n){return getLogEntryInWireFormat(n,r)}),f=getLogBatchInWireFormat(r,u,t,i);return JSON.stringify(f)}function getLogEntryInWireFormat(n,t){var i={},r;return i.G=n.tag,i.T=n.timestamp-t,i.M=n.message,i.C=n.category,r=n.type*shiftFactory+n.level,i.D=r,i}function getLogBatchInWireFormat(n,t,i,r){var u={};return u.T=n,u.L=t,u.S=i,u.I=r,u.V=1,u}function uploadLogs(n,t,i){if(t!==""){var r=new XMLHttpRequest;(r.readyState===XMLHttpRequest.UNSENT||r.readyState===XMLHttpRequest.DONE)&&(r.open("POST",t,i),r.send(n))}}var logLevel,ULS,currentLevel,bUlsCache,shiftFactory,logCategory,logType,PowerPointOnline;(function(n){n[n.Spam=200]="Spam";n[n.Verbose=100]="Verbose";n[n.Info=50]="Info";n[n.Warning=15]="Warning";n[n.Error=10]="Error"})(logLevel||(logLevel={}));ULS={getLogger:getLogger};currentLevel=logLevel.Info;bUlsCache=function(){function n(t,i){var r=this;this.uploadId=0;this.logCache=[];this.timestampBase=Date.now();this.userSessionId="00000000-0000-0000-0000-000000000000";this.flushOnClose=function(){r.triggerUpload(!1,!1)};this.flush=function(){r.triggerUploadAsync()};this.triggerUploadAsync=function(){window.setTimeout(function(){return r.triggerUpload(!0,!0)},0)};this.triggerUpload=function(t,i){if(window.clearTimeout(r.timeoutId),r.logCache.length>0){r.uploadId+=1;var u=formatForUpload(r.logCache,r.userSessionId,r.uploadId,r.timestampBase);uploadLogs(u,r.remoteUrlEndpoint,i);r.logCache=[];r.timestampBase=Date.now()}t&&(r.timeoutId=window.setTimeout(r.triggerUploadAsync,n.uploadCadenceInMsSec))};this.userSessionId=t;this.remoteUrlEndpoint=i+"?usid="+t;window.setTimeout(function(){return r.triggerUpload(!0,!0)},0)}return n.prototype.handleTrace=function(t){t.message.length>n.messageMaxChars&&(t.message=t.message.substr(0,n.messageMaxChars-n.trimedMessage.length)+n.trimedMessage);this.logCache.push(t);(this.logCache.length>n.uploadTriggerSize||t.level===logLevel.Error)&&this.triggerUploadAsync()},n.messageMaxChars=3072,n.uploadCadenceInMsSec=3e4,n.uploadTriggerSize=30,n.trimedMessage="... [Trimmed]",n}();shiftFactory=1e3,function(n){n[n.WordViewer=301]="WordViewer";n[n.WopiPendingApplication=379]="WopiPendingApplication";n[n.VisioApp=700]="VisioApp";n[n.PptNavigation=810]="PptNavigation";n[n.PptSession=817]="PptSession";n[n.PptVersionHistory=832]="PptVersionHistory";n[n.PptLive=833]="PptLive"}(logCategory||(logCategory={})),function(n){n[n.Trace=0]="Trace";n[n.Assert=1]="Assert"}(logType||(logType={})),function(n){var t;(function(n){var r=function(){function n(){}return n.prototype.trace=function(n,t,i){this.traceTag(0,n,t,i)},n.prototype.traceTag=function(n,t,i,r){var u=null;switch(i){case logLevel.Verbose:u=console.debug;break;case logLevel.Info:u=console.log;break;case logLevel.Warning:case logLevel.Error:u=console.error;break;default:u=console.error}u(r)},n}(),t,i;n.ConsoleSessionLogger=r;t=function(){function n(n,t){try{this.logger=ULS.getLogger(n,t+"RemoteUls.ashx")}catch(i){}}return n.prototype.trace=function(n,t,i){this.logger!=null&&this.logger.ULS.trace(n,t,i)},n.prototype.traceTag=function(n,t,i,r){this.logger!=null&&this.logger.ULS.traceTag(n,t,i,r)},n.prototype.flush=function(){this.logger!=null&&this.logger.ULS.flush()},n.prototype.flushOnClose=function(){this.logger!=null&&this.logger.ULS.flushOnClose()},n}();n.UlsSessionLogger=t;i=function(){function n(){}return n.init=function(n){this.logger=n},n.trace=function(n,t,i){this.logger!=null&&this.logger.trace(n,t,i)},n.traceTag=function(n,t,i,r){this.logger!=null&&this.logger.traceTag(n,t,i,r)},n}();n.SessionLogger=i})(t=n.Telemetry||(n.Telemetry={}))}(PowerPointOnline||(PowerPointOnline={}));"use strict";var __assign=this&&this.__assign||Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Configuration=function(){function n(){}return n.HostCallbackTimeout=6e4,n}(),BuildVersionConfig=function(){function n(){}return Object.defineProperty(n,"BUILD_NUMBER",{get:function(){return"16.0.12008.35433"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"BUILD_NUMBER_MINOR",{get:function(){return 1200835433},enumerable:!0,configurable:!0}),Object.defineProperty(n,"BUILD_CDN_NUMBER",{get:function(){return"161200835433"},enumerable:!0,configurable:!0}),n}(),BrowserUtils=function(){function n(){}return n.IsIPad=function(){return window.navigator.userAgent.indexOf("iPad")>=0},n.IsAndroid=function(){return window.navigator.userAgent.indexOf("Android")>=0},n.IsMobile=function(){return n.IsIPad()||n.IsAndroid()},n.MaxTouchPoints=function(){var n=window.navigator.maxTouchPoints||window.navigator.msMaxTouchPoints;return n&&!isNaN(n)?n:0},n.SupportsTouch=function(){return n.IsMobile()||n.MaxTouchPoints()>0},n.DevicePixelRatio=function(){return window.devicePixelRatio||(window.screen?window.screen.deviceXDPI/window.screen.logicalXDPI:1)||1},n.IsRibbonMinimized=function(){var t=""+document.cookie;return t.indexOf(n.EditRibbonMinimizedCookieName+"=true")>=0},n.BrowserSupportsRenderingSVGInWebGL=function(){var u=!1,t,i,r;if(!n.iOS9OrOlderDetected()&&!n.IsSafariAtLeast(1))try{t=document.createElement("canvas");(t.getContext("webgl")||document.createElement("canvas").getContext("experimental-webgl"))&&(i=document.createElement("canvas").getContext("2d"),i&&(r=document.createElement("img"),r.src="data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3C/svg%3E",i.drawImage(r,0,0,10,10),t.toDataURL("image/png"),u=!0))}catch(f){}return u},n.IsSafariAtLeast=function(n){var t=window.navigator.userAgent.toLowerCase(),i,r,u;return t.indexOf(" applewebkit/")>-1&&t.indexOf("edge/")<0&&(i=t.indexOf("version/"),i>=0)?(r=i+8,u=t.length,parseInt(t.substring(r,u))>=n):!1},n.iOS9OrOlderDetected=function(){var n=window.navigator.userAgent.toLowerCase(),r,t,i;return(n.indexOf("iphone")!=-1||n.indexOf("ipad")!=-1||n.indexOf("ipod")!=-1)&&(r=new RegExp("os (\\d+)_"),t=r.exec(n),t&&t.length>=2)?(i=parseInt(t[1]),!isNaN(i)&&i<=9):!1},n.EditRibbonMinimizedCookieName="WACRibbonMinimizedPPT",n}(),HTMLHelper=function(){function n(){}return n.toPx=function(n){return isNaN(n)?"":n.toString()+"px"},n.floatToPercent=function(n){return(n*100).toString()+"%"},n}(),PPTApplication=function(){function n(n,t,i,r,u,f){this.eventHandlers={};this.m_disposeTelemetry={};this.c_wacFrameUnloadTimeoutInMs=1e3;this.m_unloading=!1;this.m_disposed=!1;this.m_sessionId=n;this.m_disposeCallback=t;this.m_frame=i;this.m_logger=r;var e=UrlUtils.getOrigin(u);this.m_postMessenger=new PostMessageHandler(e,r);this.m_postMessenger.RegisterMessagePayloadHandler("App_Unloaded",this.handleAppUnloaded.bind(this));f&&this.m_postMessenger.RegisterMessagePayloadHandler("App_AccessibilityLoopComplete",this.handleAccessibilityLoopComplete.bind(this))}return n.prototype.GetApplicationType=function(){return"PowerPoint"},n.prototype.GetVersion=function(){return BuildVersionConfig.BUILD_NUMBER},n.prototype.GetSessionId=function(){return this.m_sessionId},n.prototype.RegisterEventHandler=function(n,t){if(n!==undefined){if(this.eventHandlers[n])throw new Error("Duplicate registration");this.eventHandlers[n]=t}},n.prototype.RemoveEventHandler=function(n,t){this.eventHandlers[n]!==t&&delete this.eventHandlers[n]},n.prototype.RegisterErrorHandler=function(n){n!==undefined&&(this.errorHandler=n);throw Error("Not Implemented");},n.prototype.RemoveErrorHandler=function(n){n!==undefined&&delete this.errorHandler;throw Error("Not Implemented");},n.prototype.TriggerDocReboot=function(){this.raiseEvent("DocReboot",null)},n.prototype.Dispose=function(n){this.m_disposed||this.m_unloading&&n||(this.m_disposeTelemetry.DisposeStart=Date.now(),n?(this.m_unloading=!0,this.m_disposeTelemetry.HostUnloadSent=Date.now(),this.m_postMessenger.SendPostMessage(this.m_frame.contentWindow,"Host_Unload",{}),window.setTimeout(this.handleApplicationUnloadTimeout.bind(this),this.c_wacFrameUnloadTimeoutInMs)):this.disposeInternal())},n.prototype.disposeInternal=function(){this.m_disposed||(this.m_disposed=!0,this.m_unloading=!1,this.m_disposeCallback&&this.m_disposeCallback(this.m_sessionId),this.raiseEvent("Unloaded",{}),this.m_disposeTelemetry.DisposeDone=Date.now(),this.m_logger.ULS.traceTag(41710159,logCategory.WopiPendingApplication,logLevel.Info,JSON.stringify(this.m_disposeTelemetry)),delete this.eventHandlers,delete this.errorHandler)},n.prototype.handleAppUnloaded=function(){this.m_disposeTelemetry.AppUnloadedReceived=Date.now();this.disposeInternal()},n.prototype.handleApplicationUnloadTimeout=function(){(this.m_unloading||!this.m_disposed)&&(this.m_logger.ULS.traceTag(41710160,logCategory.WopiPendingApplication,logLevel.Warning,"Unload timed out"),this.m_disposeTelemetry.AppUnloadTimedout=Date.now());this.disposeInternal()},n.prototype.handleAccessibilityLoopComplete=function(n){window.parent!==window&&this.m_postMessenger.SendPostMessage(window.parent,"App_AccessibilityLoopComplete",n);this.raiseEvent("App_AccessibilityLoopComplete",n)},n.prototype.raiseEvent=function(n,t){var i=this.eventHandlers[n];i&&i(t||{})},n}(),Dimensions=function(){function n(n,t){this.Width=n;this.Height=t}return n}(),SlideDimensionsHelper=function(){function n(){}return n.AdjustDimensionsForScrollbars=function(n,t,i,r){var u=new Dimensions(n.Width,n.Height),f=u.Width<t,e;return f&&(u.Height-=r),e=u.Height<i,e&&(u.Width-=r),!f&&u.Width<t&&(f=!0,u.Height-=r),u.Width=Math.max(u.Width,t),u.Height=Math.max(u.Height,i),u},n.GetAdjustedSlideDimensions=function(t,i){var r=i.Width,u=i.Height;return u-=n.EditNotesHeightPeek+1,r-=n.AreaWidth+1+n.DefaultScrollbarSize,n.CalculateAvailableSlideDimensions(new Dimensions(r,u),t)},n.CalculateAvailableSlideDimensions=function(t,i){var r=new Dimensions(t.Width-2*n.SlidePadding,t.Height-2*n.SlidePadding),u=new Dimensions(i.Width/2,i.Height/2),f=new Dimensions(i.Width*2,i.Height*2);return r.Width<u.Width?r.Width=u.Width:r.Width>f.Width&&(r.Width=f.Width),r.Height<u.Height?r.Height=u.Height:r.Height>f.Height&&(r.Height=f.Height),r},n.CalculateEditingAreaDimensions=function(){var t=n.AdjustDimensionsForScrollbars(new Dimensions(window.document.documentElement.clientWidth,window.document.documentElement.clientHeight-n.UnifiedHeaderHeight),n.EditAreaMinimumWidth,n.EditAreaMinimumHeight,n.DefaultScrollbarSize);return BrowserUtils.IsRibbonMinimized()||(t.Height-=BrowserUtils.SupportsTouch()?n.EditLowerRibbonHeightTouchPx:n.EditLowerRibbonHeightMousePx),t.Height-=n.EditDefaultRibbonHeight,t.Height-=n.StatusBarHeight,t},n.UnifiedHeaderHeight=50,n.EditAreaMinimumWidth=756,n.EditAreaMinimumHeight=513,n.DefaultScrollbarSize=17,n.EditDefaultRibbonHeight=30,n.EditLowerRibbonHeightMousePx=94,n.EditLowerRibbonHeightTouchPx=108,n.StatusBarHeight=23,n.EditNotesHeightPeek=32,n.AreaWidth=238,n.SlidePadding=10,n}(),QueryStringParamForwarder=function(){function n(){}return n.Forward=function(t,i){return!t||t.substr(0,2)!="wd"||n.noForwardArray.indexOf(t)>=0?null:t+"="+i},n.noForwardArray=["wdPodsUrl","wdPopsUrl","wdNewPodsFrame","wdNewEnabled","wdfs","wdfsection","wdIncludeHostUrl","wdoverrides"],n}(),UrlOverrideUtils=function(){function n(){}return n.UpdateOverride=function(n){for(var h,e,i,u,o,c,t,r="",l=window.location.search.substring(1,window.location.search.length).split("&"),f=0,s=l;f<s.length;f++)h=s[f],t=h.split("="),t[0]=="wdoverrides"&&(r=t[1]),e=QueryStringParamForwarder.Forward(t[0],t[1]),e&&(n+="&"+e);for(r=r||"",i=[],u=0,o=r.split(",");u<o.length;u++)(c=o[u],t=c.split(":"),t.length==2&&t[0].toLowerCase()!="devicepixelratio")&&i.push(t[0]+":"+t[1]);return i.push("devicepixelratio:"+BrowserUtils.DevicePixelRatio()),i.push("RenderGifSlideShow:true"),UrlUtils.addOrReplaceParameterValue(n,"wdoverrides",i.join(","))},n}(),WacFallbackController=function(){function n(n,t,i,r,u,f,e){this.BootFailed=!1;this.InitializeWopiPendingParameters=n;this.m_forceWacFallback=t;this.GetFallbackUrl=i;this.OnSuccessWopiInfoCallback=r;this.logger=u;this.windowVisibilityMetrics=f;this.m_postMessageToken=e}return n.prototype.WopiPendingApplicationComplete=function(n,t){this.m_forceWacFallback||this.BootFailed?PPTBootstrapper.LaunchWacFallback(n,this.InitializeWopiPendingParameters,this.GetFallbackUrl,this.BootFailureInfo,this.logger,this.windowVisibilityMetrics,this.m_postMessageToken):(this.ReturnedWopiInfo=n,this.OnSuccessWopiInfoCallback&&this.OnSuccessWopiInfoCallback(this.ReturnedWopiInfo,t))},n.prototype.OnBootFailed=function(n){for(this.logger.ULS.traceTag(35997389,logCategory.PptSession,logLevel.Error,"Failed to Boot Previewer"),this.BootFailed=!0,this.BootFailureInfo=n;this.InitializeWopiPendingParameters.Container.firstChild;)this.InitializeWopiPendingParameters.Container.removeChild(this.InitializeWopiPendingParameters.Container.firstChild);this.ReturnedWopiInfo&&PPTBootstrapper.LaunchWacFallback(this.ReturnedWopiInfo,this.InitializeWopiPendingParameters,this.GetFallbackUrl,this.BootFailureInfo,this.logger,this.windowVisibilityMetrics,this.m_postMessageToken)},n.prototype.WopiPendingApplicationFail=function(n){n;this.logger.ULS.traceTag(38293905,logCategory.PptSession,logLevel.Info,"Host failed to give us WopiInfo")},n}(),WopiPendingApplication=function(){function n(){}return n.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n==="x"?t:t&3|8;return i.toString(16)})},n.GetApplicationParameters=function(t){return{container:t.Container,sessionInformation:t.SessionInformation,applicationUrl:t.ApplicationUrl,wopiPrecheckInfo:t.WopiPrecheckInfo,applicationCustomSettings:t.ApplicationCustomSettings,diagnostics:t.Diagnostics,fnOnInitializeSuccess:t.FnOnInitializeSuccess,fnOnInitializeFailure:t.FnOnInitializeFailure,sessionId:t.SessionInformation&&t.SessionInformation.HostSessionId?t.SessionInformation.HostSessionId:n.newGuid(),applicationBaseUrl:UrlUtils.getApplicationBaseUrl(t.ApplicationUrl)}},n}(),ApplicationBootstrapper=function(){function n(){}return n.validateParametersWopiPending=function(n){var i,t,r,u,f,e;if(n===undefined)throw new TypeError("initParams");if(i=n.Container,i===undefined||i.appendChild===undefined)throw new TypeError("Container");if(t=n.SessionInformation,t===undefined||t.HostName===undefined||t.HostSessionId===undefined||t.UserId===undefined)throw new TypeError("SessionInformation");if(r=n.ApplicationUrl,r===undefined||typeof r!="string")throw new TypeError("ApplicationUrl");if(u=n.WopiPrecheckInfo,u===undefined||u.FileName===undefined)throw new TypeError("WopiPrecheckInfo");if(f=n.FnOnInitializeSuccess,f===undefined)throw new TypeError("FnOnInitializeSuccess");if(e=n.FnOnInitializeFailure,e===undefined)throw new TypeError("FnOnInitializeFailure");},n}(),ApplicationErrors=function(){function n(){}return Object.defineProperty(n,"AppInitError",{get:function(){return"AppInitError"},enumerable:!0,configurable:!0}),n}(),PostMessageHandler=function(){function n(n,t){var i=this;if(this.eventHandlers={},!n)throw new Error("Missing origin for PostMessageHandler");this.logger=t;this.origin=n.toLowerCase();window.addEventListener("message",function(n){return i.handleWacFramePostMessage(n)},!1)}return n.prototype.RegisterMessagePayloadHandler=function(n,t){if(this.eventHandlers[n])throw new Error("Duplicate registration!");this.eventHandlers[n]=t},n.prototype.RemoveMessageHandler=function(n){delete this.eventHandlers[n]},n.prototype.SendPostMessage=function(n,t,i){this.logger.ULS.traceTag(596464334,logCategory.WopiPendingApplication,logLevel.Info,"PostMessageHandler - Sending message: "+t);var r={MessageId:t,SendTime:Date.now(),Values:i};this.sendPostMessageInternal(n,JSON.stringify(r),this.origin)},n.prototype.Dispose=function(){delete this.eventHandlers},n.prototype.handleWacFramePostMessage=function(n){var i,t,r;if(n.origin&&n.origin.toLowerCase()===this.origin){try{i=JSON.parse(n.data)}catch(u){this.logger.ULS.traceTag(596464282,logCategory.WopiPendingApplication,logLevel.Error,"PostMessageHandler - failed to parse event data: "+JSON.stringify(u));return}if(t=i.MessageId,t){if(r=this.eventHandlers[t],!r){this.logger.ULS.traceTag(596464289,logCategory.WopiPendingApplication,logLevel.Info,"PostMessageHandler - no handler found for message id: "+t);return}this.logger.ULS.traceTag(596464288,logCategory.WopiPendingApplication,logLevel.Info,"PostMessageHandler - processing message: "+t);r(i.Values||{})}}},n.prototype.sendPostMessageInternal=function(n,t,i){n.postMessage(t,i)},n}(),SHA1=function(){function n(){}return n.RotateLeft=function(n,t){return n<<t|n>>32-t},n.ConvertHex=function(n){for(var i=[],r,t=7;t>=0;t--)r=n>>t*4&15,i.push(r.toString(16));return i.join("")},n.Utf8Encode=function(n){var i,r,t;for(n=n.replace("\r\n","\n"),i="",r=0;r<n.length;r++)t=n.charCodeAt(r),t<128?i+=String.fromCharCode(t):t>127&&t<2048?(i+=String.fromCharCode(t>>6|192),i+=String.fromCharCode(t&63|128)):(i+=String.fromCharCode(t>>12|224),i+=String.fromCharCode(t>>6&63|128),i+=String.fromCharCode(t&63|128));return i},n.GenerateSHA1=function(t){var i,k,a,v=1732584193,y=4023233417,p=2562383102,w=271733878,b=3285377520,e,r,u,f,h,o=0,c=new Array(80),s,l,d;for(t=n.Utf8Encode(t),s=t.length,l=[],i=0;i<s-3;i+=4)k=t.charCodeAt(i)<<24|t.charCodeAt(i+1)<<16|t.charCodeAt(i+2)<<8|t.charCodeAt(i+3),l.push(k);switch(s%4){case 0:o=2147483648;break;case 1:o=t.charCodeAt(s-1)<<24|8388608;break;case 2:o=t.charCodeAt(s-2)<<24|t.charCodeAt(s-1)<<16|32768;break;case 3:o=t.charCodeAt(s-3)<<24|t.charCodeAt(s-2)<<16|t.charCodeAt(s-1)<<8|128}for(l.push(o);l.length%16!=14;)l.push(0);for(l.push(s>>29),l.push(s<<3&4294967295),a=0;a<l.length;a+=16){for(i=0;i<16;i++)c[i]=l[a+i];for(i=16;i<=79;i++)c[i]=n.RotateLeft(c[i-3]^c[i-8]^c[i-14]^c[i-16],1);for(e=v,r=y,u=p,f=w,h=b,i=0;i<=19;i++)o=n.RotateLeft(e,5)+(r&u|~r&f)+h+c[i]+1518500249&4294967295,h=f,f=u,u=n.RotateLeft(r,30),r=e,e=o;for(i=20;i<=39;i++)o=n.RotateLeft(e,5)+(r^u^f)+h+c[i]+1859775393&4294967295,h=f,f=u,u=n.RotateLeft(r,30),r=e,e=o;for(i=40;i<=59;i++)o=n.RotateLeft(e,5)+(r&u|r&f|u&f)+h+c[i]+2400959708&4294967295,h=f,f=u,u=n.RotateLeft(r,30),r=e,e=o;for(i=60;i<=79;i++)o=n.RotateLeft(e,5)+(r^u^f)+h+c[i]+3395469782&4294967295,h=f,f=u,u=n.RotateLeft(r,30),r=e,e=o;v=v+e&4294967295;y=y+r&4294967295;p=p+u&4294967295;w=w+f&4294967295;b=b+h&4294967295}return d=n.ConvertHex(v)+n.ConvertHex(y)+n.ConvertHex(p)+n.ConvertHex(w)+n.ConvertHex(b),d.toLowerCase()},n}(),UrlUtils=function(){function n(){}return n.getApplicationBaseUrl=function(n){var t,i,r;if(!n)return"";if(t=n.indexOf("/",8),t<0)throw new Error("URL should contain a / after domain");if(i=n.indexOf(".",t),i>=0&&(r=n.lastIndexOf("/",i),r>=0))return n.substr(0,r+1);throw new Error("URL should contain a . after domain");},n.getParameterValue=function(n,t){var i=n.indexOf("&"+t+"="),r,u;return(i===-1&&(i=n.indexOf("?"+t+"=")),i===-1)?"":(r=i+(t.length+2),u=n.indexOf("&",r),u===-1)?n.substr(r):n.substring(r,u)},n.getParameterValueDecoded=function(t,i){var r=n.getParameterValue(t,i);return r?decodeURI(r):r},n.getOrigin=function(n){return n.replace(/^(.*\/\/[^\/?#]*).*$/,"$1")},n.addQueryParam=function(n,t,i){var r=n,f=r.indexOf("?"),u="&";return(f===r.length-1?u="":f===-1&&(u="?"),u==="&"&&r.indexOf(t+"=",f)>=0)?r:r.concat(u,t,"=",i)},n.addOrReplaceParameterValue=function(n,t,i){var u;if(!t)return n;var r=n,f=i==null,s=r.indexOf("?");if(-1===s)return f?n:r+"?"+t+"="+i;var h=r.substr(s+1),e=h.split("&"),o=t+"=",c=!1;for(u=0;u<e.length;u=u+1)if(0===e[u].indexOf(o)){r=r.replace(e[u],f?"":o+i);c=!0;break}return c||f||(h.length>0&&(r+="&"),r+=o+i),r},n.HTMLEncode=function(t){return n.EncodeString(t,n.htmlEncodeReplacements)},n.GetQueryStringParam=function(t){return n.getParameterValue(window.location.href,t)},n.UrlKeyValueEncode=function(t){var i=encodeURIComponent(t);return n.EncodeString(i,n.urlKeyValueEncodeReplacements)},n.EncodeString=function(n,t){for(var r=n,u=t.length,i=0;i<u;i=i+1)r=r.replace(t[i].FindExpression,t[i].ReplaceValue);return r},n.Base64Decode=function(n){var t=(n+"===").substring(0,n.length+(4-n.length%4)%4);return t=t.replace(new RegExp("-","g"),"+"),t=t.replace(new RegExp("_","g"),"/"),atob(t)},n.urlKeyValueEncodeReplacements=[{FindExpression:new RegExp("!","g"),ReplaceValue:"%21"},{FindExpression:new RegExp("'","g"),ReplaceValue:"%27"},{FindExpression:new RegExp("\\(","g"),ReplaceValue:"%28"},{FindExpression:new RegExp("\\)","g"),ReplaceValue:"%29"},{FindExpression:new RegExp("\\*","g"),ReplaceValue:"%2A"},],n.htmlEncodeReplacements=[{FindExpression:new RegExp("&","g"),ReplaceValue:"&#"+"&".charCodeAt(0)+";"},{FindExpression:new RegExp("<","g"),ReplaceValue:"&#"+"<".charCodeAt(0)+";"},{FindExpression:new RegExp(">","g"),ReplaceValue:"&#"+">".charCodeAt(0)+";"},{FindExpression:new RegExp("'","g"),ReplaceValue:"&#"+"'".charCodeAt(0)+";"},{FindExpression:new RegExp("\\\\","g"),ReplaceValue:"&#"+"\\\\".charCodeAt(0)+";"},{FindExpression:new RegExp('"',"g"),ReplaceValue:"&#"+'"'.charCodeAt(0)+";"},],n}(),VisibilityChangeEvents=[],WindowVisibilityMetrics=function(){function n(){this.initialize()}return n.prototype.initialize=function(){if(document.visibilityState==="hidden"){var n={visibility:document.visibilityState,time:Date.now(),initialState:!0};VisibilityChangeEvents.push(n)}document.addEventListener("visibilitychange",this.handleVisibilityChange)},n.prototype.Stop=function(){document.removeEventListener("visibilitychange",this.handleVisibilityChange)},n.prototype.GetVisibilityChangeEvents=function(){return VisibilityChangeEvents},n.prototype.handleVisibilityChange=function(){var n={visibility:document.visibilityState,time:Date.now(),initialState:!1};VisibilityChangeEvents.push(n)},n}(),ContentBundleParameters=function(){function n(){}return n}(),CreateNewScenario,MessageType;(function(n){n[n.UnifiedCreateNew=1]="UnifiedCreateNew";n[n.LegacyCreateNew=2]="LegacyCreateNew";n[n.NotCreateNew=3]="NotCreateNew"})(CreateNewScenario||(CreateNewScenario={}));var PODSRegion=function(){function n(n,t,i){t===void 0&&(t=1);i===void 0&&(i="https://c1-powerpoint-15.cdn.office.net/pods/s/");this.PodsURL=n;this.RolloutPercentage=t;this.WacCdnStaticServer=i}return n}(),UsePODSDetails=function(){function n(n,t,i,r){this.ShouldUsePODS=n;this.CanUsePODS=t;this.Reason=i;this.CreateNewScenario=r}return n}(),PodsRegionInfo=function(){function n(){}return n.GetWacToPodsUnifiedMap=function(){var t={};return t[n.ffcUrl]=new PODSRegion(n.ffcUrl+n.pods),t[n.ppcUrl]=new PODSRegion(n.ppcUrl+n.pods),t[n.dfUrl]=new PODSRegion(n.dfUrl+n.pods),t[n.prodUrl]=new PODSRegion(n.prodUrl+n.pods),t[n.uscUrl]=new PODSRegion(n.uscUrl+n.pods),t[n.eucUrl]=new PODSRegion(n.eucUrl+n.pods),t[n.cacUrl]=new PODSRegion(n.cacUrl+n.pods),t[n.ukcUrl]=new PODSRegion(n.ukcUrl+n.pods),t[n.aucUrl]=new PODSRegion(n.aucUrl+n.pods),t[n.jpcUrl]=new PODSRegion(n.jpcUrl+n.pods),t[n.incUrl]=new PODSRegion(n.incUrl+n.pods),t[n.krcUrl]=new PODSRegion(n.krcUrl+n.pods),t[n.frcUrl]=new PODSRegion(n.frcUrl+n.pods),t[n.sgcUrl]=new PODSRegion(n.sgcUrl+n.pods),t[n.zacUrl]=new PODSRegion(n.zacUrl+n.pods),t[n.aecUrl]=new PODSRegion(n.aecUrl+n.pods),t[n.blackforestUrl]=new PODSRegion(n.blackforestUrl+n.pods,.5,"https://powerpoint.cdn.office.de/pods/s/"),t[n.gallatinUrl]=new PODSRegion(n.gallatinUrl+n.pods,.25,"https://cdn.partner.officewebapps.cn/pods/s/"),t[n.usGovUrl]=new PODSRegion(n.usGovUrl+n.pods,0,"https://powerpoint.cdn.office365.us/pods/s/"),t[n.usDoDUrl]=new PODSRegion(n.usDoDUrl+n.pods,0,"https://powerpoint.dod.cdn.office365.us/pods/s/"),t},n.GetWacToPodsPreviewerMap=function(){var t={};return t[n.ffcUrl]=new PODSRegion(n.https+n.hostOSI.substring(1),1,"https://c5-powerpoint-15.cdn.office.net/pods/s/"),t[n.ppcUrl]=new PODSRegion(n.https+"usc"+n.hostOSI,1,"https://c4-powerpoint-15.cdn.office.net/pods/s/"),t[n.dfUrl]=new PODSRegion(n.https+"pods.edog.officeapps.live.com/",1,"https://c5-powerpoint-15.cdn.office.net/pods/s/"),t[n.prodUrl]=new PODSRegion(n.https+n.hostOSI.substring(1)),t[n.uscUrl]=new PODSRegion(n.https+"usc"+n.hostOSI),t[n.eucUrl]=new PODSRegion(n.https+"euc"+n.hostOSI),t[n.cacUrl]=new PODSRegion(n.https+"canc"+n.hostOSI),t[n.ukcUrl]=new PODSRegion(n.https+"ukc"+n.hostOSI),t[n.aucUrl]=new PODSRegion(n.https+"ausc"+n.hostOSI),t[n.jpcUrl]=new PODSRegion(n.https+"jpc"+n.hostOSI),t[n.incUrl]=new PODSRegion(n.https+"inc"+n.hostOSI),t[n.krcUrl]=new PODSRegion(n.https+"krc"+n.hostOSI),t[n.frcUrl]=new PODSRegion(n.https+"frc"+n.hostOSI),t[n.usGovUrl]=new PODSRegion(n.https+"pods.osi.office365.us/",1,"https://powerpoint.cdn.office365.us/pods/s/"),t[n.usDoDUrl]=new PODSRegion(n.https+"pods.osi.apps.mil/",1,"https://powerpoint.dod.cdn.office365.us/pods/s/"),t},n.TryGetPodsRegion=function(t,i){var r=t.substring(0,t.indexOf("/p/"));return i?n.WacToPodsUnifiedMap[r.toLowerCase()]:n.WacToPodsPreviewerMap[r.toLowerCase()]},n.https="https://",n.pods="/pods/",n.hostWAC="-powerpoint.officeapps.live.com",n.hostOSI=".pods.officeapps.live.com/",n.ffcUrl=n.https+"ffc"+n.hostWAC,n.ppcUrl=n.https+"ppc"+n.hostWAC,n.uscUrl=n.https+"usc"+n.hostWAC,n.eucUrl=n.https+"euc"+n.hostWAC,n.cacUrl=n.https+"cac"+n.hostWAC,n.ukcUrl=n.https+"ukc"+n.hostWAC,n.aucUrl=n.https+"auc"+n.hostWAC,n.jpcUrl=n.https+"jpc"+n.hostWAC,n.incUrl=n.https+"inc"+n.hostWAC,n.krcUrl=n.https+"krc"+n.hostWAC,n.frcUrl=n.https+"frc"+n.hostWAC,n.sgcUrl=n.https+"sgc"+n.hostWAC,n.zacUrl=n.https+"zac"+n.hostWAC,n.aecUrl=n.https+"aec"+n.hostWAC,n.blackforestUrl=n.https+"powerpoint.online.office.de",n.gallatinUrl=n.https+"cnc-powerpoint.partner.officewebapps.cn",n.usGovUrl=n.https+"powerpoint.gov.online.office365.us",n.usDoDUrl=n.https+"powerpoint.dod.online.office365.us",n.prodUrl=n.https+n.hostWAC.substring(1),n.dfUrl=n.https+"powerpoint.officeapps-df.live.com",n.WacToPodsUnifiedMap=n.GetWacToPodsUnifiedMap(),n.WacToPodsPreviewerMap=n.GetWacToPodsPreviewerMap(),n}(),MathHelper=function(){function n(){}return n.Hash=function(n){for(var t=0,i=0;i<n.length;i++)t=(t<<5)-t+n.charCodeAt(i),t=t&t;return t},n}(),PPTBootstrapper=function(){function n(){}return n.EnsureInitializeParametersAreTheRightType=function(n){return n.WopiPrecheckInfo.PreseededSessionKey&&(n.WopiPrecheckInfo.PreseededSessionKey.slice(0,6)!="_._._."||n.WopiPrecheckInfo.PreseededSessionKey.slice(-6)!="-.-.-.")&&(n.WopiPrecheckInfo.PreseededSessionKey="_._._."+n.WopiPrecheckInfo.PreseededSessionKey+"-.-.-."),n.ApplicationCustomSettings&&n.ApplicationCustomSettings.EnableWacFallback==null&&(n.ApplicationCustomSettings.EnableWacFallback=!0),n},n.GetOnDemandServer=function(n,t){var i,r,u;if(t===void 0&&(t=!1),n&&n.ApplicationCustomSettings&&n.ApplicationCustomSettings.OnDemandServer)return n.ApplicationCustomSettings.OnDemandServer;if(n&&n.ApplicationUrl&&(i=PodsRegionInfo.TryGetPodsRegion(n.ApplicationUrl,t),i))return i.PodsURL;r=PPTBootstrapSettings.getAppMetadata();u=r?r.Environment:"";switch(u){case"int":return"https://PODS.officeapps.live-int.com/";case"edog":return"https://PODS.edog.officeapps.live.com/";case"prod":return"https://PODS.officeapps.live.com/";case"wac":return n&&n.ApplicationUrl?n.ApplicationUrl.substring(0,n.ApplicationUrl.indexOf("PowerPointFrame.aspx")).replace("/p/","/pods/"):"";default:return"https://localhost:8080/"}},n.GetWacStaticResourcesServer=function(n,t,i){var r,u;if(n&&n.WacStaticResourcesServer)return n.WacStaticResourcesServer;if(i)return r="pods/s/",i.split(r)[0]+r;if(t){if(u=PodsRegionInfo.TryGetPodsRegion(t,!1),u)return u.WacCdnStaticServer;throw Error("Application url provided but region not in region allowlist");}return"https://s1-powerpoint-15.cdn.office.net/pods/s/"},n.GenerateRandomHexChar=function(){var n=new Uint8Array(1);return window.self.crypto&&window.self.crypto.getRandomValues?(window.self.crypto.getRandomValues(n),Math.floor(n[0]/16).toString(16)):window.msCrypto&&window.msCrypto.getRandomValues?(window.msCrypto.getRandomValues(n),Math.floor(n[0]/16).toString(16)):Math.floor(Math.random()*16).toString(16)},n.GenerateRandomUUID=function(){return"xxxxxxxx-xxxx-4xxx-xxxx-xxxxxxxxxxxx".replace(/[x]/g,n.GenerateRandomHexChar)},n.SendInitialLog=function(t,i,r,u){var f,l,o,a,y,e,s,v,h,c;this.s_bootstrapperInstanceIdentifier==""&&(this.s_bootstrapperInstanceIdentifier=this.GenerateRandomUUID());f={};f.BootstrapperType="TypeScript";f.Preview=i=="Previewer"?!0:!1;f.Scenario=i;f.ApplicationUrl=n.ExtractHostname(t.ApplicationUrl);f.IsDeepLink=!!UrlUtils.GetQueryStringParam("nav");f.BootstrapperInstanceId=this.s_bootstrapperInstanceIdentifier;l={};f.ApplicationCustomSettings=l;t.ApplicationCustomSettings&&(l.OnDemandServer=n.ExtractHostname(t.ApplicationCustomSettings.OnDemandServer),l.EnableWacFallback=t.ApplicationCustomSettings.EnableWacFallback);o={};f.SessionInformation=o;o.HostName=t.SessionInformation.HostName;o.HostSessionId=t.SessionInformation.HostSessionId;o.UiLocale=t.SessionInformation.UiLocale;o.DataLocale=t.SessionInformation.DataLocale;o.DocumentClickTime=t.Diagnostics&&t.Diagnostics.userClickTime?t.Diagnostics.userClickTime:t.SessionInformation.DocumentClickTime;o.HostInitTime=t.SessionInformation.HostInitTime;o.CurrentTime=(new Date).getTime();a={};f.Diagnostics=a;y=n.GetEntryPoint(t);a.EntryPoint=y;a.FileHost=t.Diagnostics&&t.Diagnostics.fileHost?t.Diagnostics.fileHost:"";e={};f.WopiPrecheckInfo=e;e.FileSize=t.WopiPrecheckInfo.FileSize;e.FileGetUrlBool=!!t.WopiPrecheckInfo.FileGetUrl;e.FileNameBool=!!t.WopiPrecheckInfo.FileName;e.ReadOnly=t.WopiPrecheckInfo.ReadOnly;e.IrmEnabled=t.WopiPrecheckInfo.IrmEnabled;e.SupportsDecryptedContentDownload=t.WopiPrecheckInfo.SupportsDecryptedContentDownload;e.ViewOnly=t.WopiPrecheckInfo.ViewOnly;e.PreseededSessionKey=!!t.WopiPrecheckInfo.PreseededSessionKey;s={};t.WopiPrecheckInfo.BundleInfo&&(v=t.WopiPrecheckInfo.BundleInfo,s.MajorVersion=v.MajorVersion,s.URLBool=!!v.Url,s.CrossOrigin=v.CrossOrigin);e.BundleInfo=s;h={};f.AppInfo=h;c=PPTBootstrapSettings.getAppMetadata();c&&(h.AppVersionMajor=c.AppVersionMajor,h.AppVersionMinor=c.AppVersionMinor,h.Environment=c.Environment);r&&(f.AdditionalTelemetry=r);u.ULS.traceTag(22357763,logCategory.PptSession,logLevel.Info,JSON.stringify(f,n.UndefinedReplacer))},n.UndefinedReplacer=function(n,t){return typeof t=="undefined"?null:t},n.InferFileNewFromWopiPrecheckInfo=function(n,t,i){var u,r,e=n,f;return e.CreateNewInfo?(r=CreateNewScenario.UnifiedCreateNew,u="CreateNewInfo"):n.IsNewFile?(r=CreateNewScenario.UnifiedCreateNew,u="CreateNewInfoIsNewFile"):n.IsNewFileFromHostTemplate?(r=CreateNewScenario.UnifiedCreateNew,u="CreateNewInfoFromHostTemplate"):t.toLowerCase().indexOf("new=1")>=0&&n.FileSize!=0?(r=CreateNewScenario.LegacyCreateNew,u="ApplicationUrlContainsNewAndNonZeroByteFile"):t.toLowerCase().indexOf("new=1")>=0?(r=CreateNewScenario.UnifiedCreateNew,u="ApplicationUrlContainsNew"):(r=CreateNewScenario.NotCreateNew,u="NotCreateNew"),f={},f.CreateNewScenario=CreateNewScenario[r],f.reason=u,i.ULS.traceTag(34932951,logCategory.PptSession,logLevel.Info,JSON.stringify(f)),r},n.PODSFlighting=function(t,i,r){var u=n.InferFileNewFromWopiPrecheckInfo(t.WopiPrecheckInfo,t.ApplicationUrl,r),f=PodsRegionInfo.TryGetPodsRegion(t.ApplicationUrl,i),e;if(f){if(i&&u==CreateNewScenario.LegacyCreateNew)return new UsePODSDetails(!1,!1,"Legacy Create New Scenario because application url contains new, but non-zero file size",u);if(window.location.search.indexOf("wdTestPreviewer=1")>=0||window.location.hash.indexOf("wdTestPreviewer=1")>=0)return new UsePODSDetails(!0,!0,"Supported Region and wdTestPreviewer/wdTestUnified set to true in Host Page URL",u);if(i){if(t.ApplicationUrl.indexOf("&Embed=1")!=-1)return f.PodsURL.indexOf("officeapps-df")!=-1?new UsePODSDetails(!0,!0,"Instant Embed View dogfood flighting",u):new UsePODSDetails(!1,!1,"Embed View fallback to WAC",u)}else if(f.PodsURL.indexOf("pods.osi.office365.us")!=-1||f.PodsURL.indexOf("pods.osi.apps.mil")!=-1)return t.SessionInformation.HostName=="MSTeams"?new UsePODSDetails(!0,!0,"Use PODS for previewer if Host is Teams and region in USGoV or USDoD",u):new UsePODSDetails(!1,!1,"Disable PODS for previewer if Host is not Teams in USGoV or USDoD",u);return f.RolloutPercentage<=0?new UsePODSDetails(!1,!1,"PODS region Disabled",u):(e=n.GetFlightingNumber(t),r.ULS.traceTag(38147723,logCategory.PptSession,logLevel.Info,"RolloutPercentage - "+f.RolloutPercentage+"; RolloutNumber - "+e),f.RolloutPercentage<e?(i&&f.PodsURL.indexOf("officeapps-df")==-1&&t.ApplicationUrl.indexOf("New=1")==-1&&(t.ApplicationUrl=t.ApplicationUrl.replace(new RegExp("PowerPointView=EditView","gim"),"PowerPointView=ReadingView")),new UsePODSDetails(!1,!0,"Could use PODS but this session was not selected as part of the rollout",u)):new UsePODSDetails(!0,!0,"Supported Region",u))}return new UsePODSDetails(!1,!1,"Wac region not currently supported by PODS",u)},n.GetFlightingNumber=function(n){return n.SessionInformation.UserId?Math.abs(MathHelper.Hash(n.SessionInformation.UserId))/100%1:Math.random()},n.LaunchWacFallback=function(n,t,i,r,u,f,e){var c,s,h,l,a,p,y,v;u.ULS.traceTag(38147724,logCategory.PptSession,logLevel.Info,"Launching Wac Fallback");var o=document.createElement("iframe");o.frameBorder="0";o.style.top=HTMLHelper.toPx(0);o.style.bottom=HTMLHelper.toPx(0);o.style.left=HTMLHelper.toPx(0);o.style.right=HTMLHelper.toPx(0);o.style.height=HTMLHelper.floatToPercent(1);o.style.width=HTMLHelper.floatToPercent(1);o.style.minWidth=HTMLHelper.toPx(300);o.style.minHeight=HTMLHelper.toPx(200);o.style.position="absolute";o.setAttribute("allowfullscreen",(!0).toString());o.setAttribute("allowTransparency",(!0).toString());o.id="WebApplicationFrame";o.title="Office Online Frame";o.name="wac_frame";c=HTMLHelper.floatToPercent(1);t.Container.style.width=c;t.Container.style.height=c;t.Container.style.minHeight=HTMLHelper.toPx(150);t.Container.style.left=HTMLHelper.toPx(0);t.Container.style.right=HTMLHelper.toPx(0);t.Container.style.bottom=HTMLHelper.toPx(0);t.Container.style.top=HTMLHelper.toPx(0);s=document.createElement("div");s.style.backgroundColor="#393a3d";s.style.backfaceVisibility="hidden";s.style.width=c;s.style.height=c;s.style.minHeight=HTMLHelper.toPx(150);s.style.left=HTMLHelper.toPx(0);s.style.right=HTMLHelper.toPx(0);s.style.bottom=HTMLHelper.toPx(0);s.style.top=HTMLHelper.toPx(0);o.style.width=c;o.style.minHeight=HTMLHelper.toPx(150);o.style.height=c;h=document.createElement("form");h.name="wac_form";h.id="wac_form";h.target="wac_frame";h.action=i(n,t);h.method="post";l=document.createElement("input");l.type="hidden";l.name="access_token";l.value=n.AccessToken;h.appendChild(l);a=document.createElement("input");a.type="hidden";a.name="access_token_ttl";a.value=!n.AccessTokenExpiry?"0":n.AccessTokenExpiry.getTime().toString();h.appendChild(a);t.Container.appendChild(h);t.Container.appendChild(s);s.appendChild(o);h.submit();p=r&&r.Code==5308440?"CannotLoadBundleItem":"FatalError";y={errorObject:{errorType:p,errorObject:r}};f.Stop();v=f.GetVisibilityChangeEvents();v&&v.length>0&&(y.documentLoadedWithTabSwitch=!0,u.ULS.traceTag(38147725,logCategory.PptSession,logLevel.Info,"Visibility Change Events:"+JSON.stringify(v)));t.FnOnInitializeSuccess(new PPTDisabledApplication(e),y)},n.ExtractHostname=function(n){return n?n.indexOf("://")>-1?n.split("/")[2]:n.split("/")[0]:null},n.GetEntryPoint=function(n){if(!n.ApplicationUrl)return null;var t=UrlUtils.getParameterValueDecoded(n.ApplicationUrl,"wdOrigin");return t?t:n.Diagnostics&&n.Diagnostics.entryPoint?n.Diagnostics.entryPoint:null},n.findBootstrapperPerfEntry=function(n,t,i){var r,u;if(n)for(r=0;r<n.length;r++)if(u=n[r],u.name.indexOf(t)>=0)return u.name.toLowerCase()!=t.toLowerCase()&&i.ULS.traceTag(38147726,logCategory.PptSession,logLevel.Info,"Found partial match for bootstrapper URL perf entry"),u;return null},n.logBootstrapperPerformanceInfo=function(t,i,r){var u,f;if(r)try{if(t||(r.ULS.traceTag(38147727,logCategory.PptSession,logLevel.Info,"Missing BootstrapperUrl, defaulting to https://contentstorage.osi.office.net/boot/ppt.boot.js"),t="https://contentstorage.osi.office.net/boot/ppt.boot.js"),!window.performance){r.ULS.traceTag(38147728,logCategory.PptSession,logLevel.Info,"Performance API not found on browser");return}if(u=undefined,window.performance.getEntriesByName&&(u=n.findBootstrapperPerfEntry(window.performance.getEntriesByName(t),t,r)),!u&&window.performance.getEntries&&(r.ULS.traceTag(38147729,logCategory.PptSession,logLevel.Info,"Searching all entries for bootstrapper timing entry."),u=n.findBootstrapperPerfEntry(window.performance.getEntries(),t,r)),!u){r.ULS.traceTag(38147730,logCategory.PptSession,logLevel.Info,"Unable to extract Bootstrapper perf info.");return}f={};f.name=t;f.logReason=i;f.nameMatchesExpected=u.name==t;f.connectEnd=u.connectEnd;f.connectStart=u.connectStart;f.domainLookupEnd=u.domainLookupEnd;f.domainLookupStart=u.domainLookupStart;f.fetchStart=u.fetchStart;f.initiatorType=u.initiatorType;f.redirectEnd=u.redirectEnd;f.redirectStart=u.redirectStart;f.requestStart=u.requestStart;f.responseEnd=u.responseEnd;f.responseStart=u.responseStart;f.duration=u.duration;f.entryType=u.entryType;f.startTime=u.startTime;f.nextHopProtocol=u.nextHopProtocol;f.workerStart=u.workerStart;f.secureConnectionStart=u.secureConnectionStart;f.transferSize=u.transferSize;f.encodedBodySize=u.encodedBodySize;f.decodedBodySize=u.decodedBodySize;r.ULS.traceTag(34928845,logCategory.PptSession,logLevel.Info,JSON.stringify(f))}catch(e){r.ULS.traceTag(38147731,logCategory.PptSession,logLevel.Warning,"Exception extracting Bootstrapper perf info. "+e)}},n.GetPostMessageToken=function(n){return!n||n.toLowerCase().indexOf("#")>-1?Math.random().toString(36).substring(2,25):n},n.AppendCommonFrameUrlQueryParams=function(t,i){var o=n.GetUI(i),r,u,f,e,s;return o&&(t=UrlUtils.addOrReplaceParameterValue(t,"ui",o)),r=n.GetDataLocale(i),r&&(t=UrlUtils.addOrReplaceParameterValue(t,"rs",r)),u=UrlUtils.getParameterValue(i.ApplicationUrl,"mscc"),u&&(t=UrlUtils.addOrReplaceParameterValue(t,"mscc",u)),f=UrlUtils.getParameterValue(i.ApplicationUrl,"wdFR"),f&&(t=UrlUtils.addOrReplaceParameterValue(t,"wdFR",f)),e=n.GetEntryPoint(i),e&&(t=UrlUtils.addOrReplaceParameterValue(t,"wdOrigin",UrlUtils.UrlKeyValueEncode(e))),s=n.GetPostMessageToken(i.PostMessageToken),i.PostMessageToken&&(t+="&postMessageToken="+s),(i.SessionInformation.DisableChat||i.ApplicationUrl.toLowerCase().indexOf("dchat=1")>-1)&&(t=UrlUtils.addOrReplaceParameterValue(t,"dchat","1")),t},n.AppendCommonFallbackQueryParams=function(n,t,i){return t.SessionInformation.HostSessionId&&(n=UrlUtils.addOrReplaceParameterValue(n,"hid",t.SessionInformation.HostSessionId)),i&&(n=UrlUtils.addOrReplaceParameterValue(n,"WOPISrc",UrlUtils.UrlKeyValueEncode(i))),n},n.GetUI=function(n){return n.SessionInformation.UiLocale?n.SessionInformation.UiLocale:UrlUtils.getParameterValueDecoded(n.ApplicationUrl,"ui")},n.GetDataLocale=function(n){return n.SessionInformation.DataLocale?n.SessionInformation.DataLocale:UrlUtils.getParameterValueDecoded(n.ApplicationUrl,"rs")},n.s_bootstrapperInstanceIdentifier="",n}();window.Microsoft||(window.Microsoft={});Microsoft.Office||(Microsoft.Office={});Microsoft.Office.PowerPoint||(Microsoft.Office.PowerPoint={}),function(n){n[n.AppPageLoading=0]="AppPageLoading";n[n.AppReadyForPostMessage=1]="AppReadyForPostMessage";n[n.AppBootComplete=2]="AppBootComplete";n[n.DEPRECATED=3]="DEPRECATED";n[n.RefreshPage=4]="RefreshPage";n[n.UpdateInitializationComplete=6]="UpdateInitializationComplete"}(MessageType||(MessageType={}));var WopiBootParams=function(){function n(){}return n.prototype.AreAllFieldsSet=function(){return!!this.m_wopiInfo&&this.m_hasAppBooted&&!!this.m_iframe&&!!this.m_podsUrl},n}(),PPTUnifiedSessionLoader=function(){function n(t){var w=this,i,s,h,r,c,u,l,f,p,e,o,a,v;this.m_wopiBootParams=new WopiBootParams;i=undefined;try{if(TimeoutWrapper.AddTimeoutWrappersToHostCallbacks(t,i),ApplicationBootstrapper.validateParametersWopiPending(t),t=PPTBootstrapper.EnsureInitializeParametersAreTheRightType(t),s=t.SessionInformation.HostSessionId,t.ApplicationCustomSettings||(t.ApplicationCustomSettings={}),t.ApplicationCustomSettings.OnDemandServer=PPTBootstrapper.GetOnDemandServer(t,!0),i=ULS.getLogger(s,t.ApplicationCustomSettings.OnDemandServer+"RemoteUls.ashx"),this.logger=i,i.ULS.traceTag(38580693,logCategory.PptSession,logLevel.Info,"PPTBootstrapper - initializing session. Build version: "+this.GetVersion()),i.ULS.traceTag(38580694,logCategory.PptSession,logLevel.Info,"Bootstrapper Init Time: "+(new Date).getTime()),h=new WindowVisibilityMetrics,this.windowVisibilityMetrics=h,window.addEventListener("unload",function(){i.ULS.traceTag(41157219,logCategory.PptSession,logLevel.Info,"Unloading bootstrapper window.");i.ULS.flushOnClose()}),i.ULS.traceTag(38580695,logCategory.PptSession,logLevel.Info,"Application.InitializeWopiPending"),t.WopiPrecheckInfo.BundleInfo||(t.WopiPrecheckInfo.BundleInfo=new ContentBundleParameters),r=PPTBootstrapper.GetPostMessageToken(s),c={},c.PostMessageToken=r,PPTBootstrapper.SendInitialLog(t,"Unified App",c,i),u=this.ShouldUseUnifiedApp(t),this.LogShouldUsePods(u,t.ApplicationUrl),l=u.ShouldUsePODS,l){if(t.IsFileNew=u.CreateNewScenario!=CreateNewScenario.NotCreateNew?!0:!1,t.PostMessageToken=r,t.WopiPrecheckInfo.ReadOnly=t.WopiPrecheckInfo.ReadOnly||!1,f=this.CreateFrame(t.Container,t),f===null){p={Message:"Error creating IFrame",HostSessionId:t.SessionInformation.HostSessionId};i.ULS.traceTag(38580696,logCategory.PptSession,logLevel.Error,JSON.stringify(p));throw Error("Error Creating IFrame");}if(i.ULS.traceTag(50376725,logCategory.PptSession,logLevel.Info,"Assigning wopiBootParams"),this.m_iframe=f.IFrameElement,this.m_wopiBootParams&&(this.m_wopiBootParams.m_iframe=f.IFrameElement,this.m_wopiBootParams.m_podsUrl=this.GetPodsUrl(t),this.m_wopiBootParams.m_readonly=t.WopiPrecheckInfo.ReadOnly,this.m_wopiBootParams.m_irmEnabled=t.WopiPrecheckInfo.IrmEnabled,this.m_wopiBootParams.m_supportsDecryptedContentDownload=t.WopiPrecheckInfo.SupportsDecryptedContentDownload,this.m_wopiBootParams.m_fileName=t.WopiPrecheckInfo.FileName),i.ULS.traceTag(50376726,logCategory.PptSession,logLevel.Info,"Assigning SessionInformation.WdParams"),this.m_sessionContext=t.SessionInformation.SessionContext?t.SessionInformation.SessionContext:"",this.m_wdParams="",t.SessionInformation.WdParams)for(e in t.SessionInformation.WdParams)this.FWdPopOrPodParam(e)||(this.m_wdParams=this.m_wdParams+"&"+e+"="+t.SessionInformation.WdParams[e]);o=__assign({},t.Diagnostics,{hostName:t.SessionInformation.HostName});o.officeFrameCreateTime=f.FrameCreateTime;o.cacheHit=!1;this.m_appData={AppInitDiagnostics:o,InitParams:t};a=PPTMessageListenerRegistry.GetInstance();a&&a.Add(r,this)}i.ULS.traceTag(50376727,logCategory.PptSession,logLevel.Info,"Creating WacFallbackController");v=new WacFallbackController(t,!l,function(t,i){return n.GetWacFallbackUrl(t,i)},function(n,t){w.OnWopiInfoReceived(n,u.CreateNewScenario,t)},i,h,r);this.m_wopiPendingApplication={Complete:function(n,t){v.WopiPendingApplicationComplete(n,t)},Fail:function(n){v.WopiPendingApplicationFail(n)}};PPTBootstrapper.logBootstrapperPerformanceInfo(t.BootstrapperUrl,"UnifiedTSBoot",i);window.setTimeout(function(){i&&i.ULS.flush()},1e4)}catch(y){i&&(i.ULS.traceTag(38580697,logCategory.PptSession,logLevel.Error,ApplicationErrors.AppInitError+": "+JSON.stringify(y,Object.getOwnPropertyNames(y))),i.ULS.flushOnClose());t.FnOnInitializeFailure({errorType:ApplicationErrors.AppInitError,errorObject:y})}}return n.prototype.GetVersion=function(){return BuildVersionConfig.BUILD_NUMBER},n.prototype.OnSliceLoaded=function(){},n.prototype.ShouldUseUnifiedApp=function(t){var i=UrlUtils.GetQueryStringParam("wdPodsEnabled"),r;return i?(r=PPTBootstrapper.InferFileNewFromWopiPrecheckInfo(t.WopiPrecheckInfo,t.ApplicationUrl,this.logger),n.HasFileGetUrlForEdit(t,new UsePODSDetails(i!="false",!0,"wdPodsEnabled is available",r))):n.HasFileGetUrlForEdit(t,PPTBootstrapper.PODSFlighting(t,!0,this.logger))},n.HasFileGetUrlForEdit=function(n,t){return n.WopiPrecheckInfo.FileGetUrl||t.CreateNewScenario!=CreateNewScenario.NotCreateNew?t:new UsePODSDetails(!1,!1,t.Reason+"| FileGetUrl is empty",t.CreateNewScenario)},n.prototype.LogShouldUsePods=function(n,t){var i={ShouldUsePodsOrCached:n.ShouldUsePODS,ShouldUsePods:n.ShouldUsePODS,CanUsePods:n.CanUsePODS,ApplicationUrl:PPTBootstrapper.ExtractHostname(t),Reason:n.Reason,CreateNewScenario:CreateNewScenario[n.CreateNewScenario]};this.logger.ULS.traceTag(38580687,logCategory.PptSession,logLevel.Info,JSON.stringify(i))},n.GetHostSessionId=function(n){return!n||n.toLowerCase().indexOf("#")>-1?Math.random().toString(36).substring(2,25):n},n.prototype.CreateFrame=function(t,i){var o,v,h,c,p,rt,w,s,l,a,st,e,r,b,k,d,g;if(!i.IsFileNew){if(!i.WopiPrecheckInfo.FileGetUrl)throw Error("Missing FileGetUrl from contentParams");if(!i.WopiPrecheckInfo.FileName)throw Error("Null or Empty Filename");}if(o=this.GetPodsUrl(i),!o)throw Error("Invalid Pods URL");if(v=this.GetPopsUrl(i),!v)throw Error("Invalid Pops URL");var nt=SlideDimensionsHelper.CalculateEditingAreaDimensions(),tt=SlideDimensionsHelper.GetAdjustedSlideDimensions(new Dimensions(848,477),nt),y=UrlUtils.GetQueryStringParam("wdEmbedView")=="true"||i.ApplicationUrl.indexOf("&Embed=1")!=-1,it=UrlUtils.GetQueryStringParam("wdMercuryEditor")=="true",ht=y?"pptEmbed.aspx":it?"mercury.aspx":"ppt.aspx",u=o+ht+"?wdPodsUrl="+UrlUtils.UrlKeyValueEncode(o)+"&wdPopsUrl="+UrlUtils.UrlKeyValueEncode(v)+"&fastBoot=true&sw="+tt.Width+"&sh="+tt.Height+"&thPanel="+nt.Height+"&ro="+i.WopiPrecheckInfo.ReadOnly+"&NoAuth=1";if(i.WopiPrecheckInfo.FileName&&(u+="&fileName="+UrlUtils.UrlKeyValueEncode(i.WopiPrecheckInfo.FileName)),h=UrlUtils.GetQueryStringParam("wdfs"),h&&(u+="&fslide="+h),c=UrlUtils.GetQueryStringParam("wdfsection"),c&&(u+="&fsection="+c),p=UrlUtils.GetQueryStringParam("wdIncludeHostUrl"),(h||c||p&&p!="false")&&(u=UrlUtils.addOrReplaceParameterValue(u,"frameURL",UrlUtils.UrlKeyValueEncode(window.location.href))),u=UrlOverrideUtils.UpdateOverride(u),u=PPTBootstrapper.AppendCommonFrameUrlQueryParams(u,i),(i.IsFileNew||it)&&(u+="&new=1"),i.WopiPrecheckInfo.FileSize&&(u+="&fs="+i.WopiPrecheckInfo.FileSize),rt=n.GetHostSessionId(i.SessionInformation.HostSessionId),i.SessionInformation.HostSessionId&&(u+="&hid="+rt),w=UrlUtils.GetQueryStringParam("Automation"),w&&(u+="&Automation="+w),i.WopiPrecheckInfo&&i.WopiPrecheckInfo.PreseededWacSessionId&&!y&&(u+="&usid="+i.WopiPrecheckInfo.PreseededWacSessionId),i.ApplicationUrl.toLowerCase().indexOf("uiembed=1")>-1&&(u+="&uiEmbed=1"),i.SessionInformation.SupportsAccessibilityLoop&&(u+="&accloop=1"),s=UrlUtils.getParameterValueDecoded(i.ApplicationUrl,"uih"),s&&(u+="&uih="+s),i.SessionInformation.HighContrastMode&&(u+="&hcm="+UrlUtils.UrlKeyValueEncode(i.SessionInformation.HighContrastMode)),l=UrlUtils.GetQueryStringParam("nav"),l)try{var ct=UrlUtils.Base64Decode(l),ut=JSON.parse(ct),ft=ut.sId;ft&&(u=UrlUtils.addOrReplaceParameterValue(u,"wdSlideId",ft),u=UrlUtils.addOrReplaceParameterValue(u,"DC","1"));a=ut.commentId;a&&a!=="null"&&(u=UrlUtils.addOrReplaceParameterValue(u,"wdCommentId",a))}catch(lt){this.logger.ULS.traceTag(38580688,logCategory.PptSession,logLevel.Error,"Failed to parse navigation ID: "+l)}if(t){var et=200,ot=300,f=document.createElement("iframe");return f.frameBorder="0",f.style.top=HTMLHelper.toPx(0),f.style.bottom=HTMLHelper.toPx(0),f.style.left=HTMLHelper.toPx(0),f.style.right=HTMLHelper.toPx(0),f.style.height=HTMLHelper.floatToPercent(1),f.style.width=HTMLHelper.floatToPercent(1),f.style.minWidth=HTMLHelper.toPx(ot),f.style.minHeight=HTMLHelper.toPx(et),f.style.position="absolute",f.setAttribute("allowfullscreen",(!0).toString()),f.setAttribute("allowTransparency",(!0).toString()),f.setAttribute("allow","microphone "+o+" "+PPTBootstrapper.GetWacStaticResourcesServer(i.ApplicationCustomSettings,i.ApplicationUrl,i.BootstrapperUrl)+";"),f.id="WebApplicationFrame",f.name="wac_frame",f.title="Office Online Frame",t.style.top=HTMLHelper.toPx(0),t.style.bottom=HTMLHelper.toPx(0),t.style.left=HTMLHelper.toPx(0),t.style.right=HTMLHelper.toPx(0),t.style.height=HTMLHelper.floatToPercent(1),t.style.width=HTMLHelper.floatToPercent(1),t.style.minWidth=HTMLHelper.toPx(ot),t.style.minHeight=HTMLHelper.toPx(et),t.appendChild(f),st=Date.now(),e=i.WopiPrecheckInfo.FileGetUrl,this.logger.ULS.traceTag(38580689,logCategory.PptSession,logLevel.Info,e?e.toString().length.toString():"null"),u+="&fileGetUrlBool="+!!e,r=document.createElement("form"),r.name="frameForm",r.id="frameForm",r.target="wac_frame",r.action=u,r.method="post",t.appendChild(r),i.WopiInfo&&(b=i.WopiInfo.WopiSrc,b&&r.appendChild(n.CreateHiddenInputElement("WOPISrc",b)),k=i.WopiInfo.AccessToken,k&&r.appendChild(n.CreateHiddenInputElement("access_token",UrlUtils.UrlKeyValueEncode(k))),d=i.WopiInfo.AccessTokenExpiry,d&&r.appendChild(n.CreateHiddenInputElement("access_token_ttl",d.getTime().toString()))),e&&r.appendChild(n.CreateHiddenInputElement("fileUrl",e)),i.SessionInformation.UserId&&(r.appendChild(n.CreateHiddenInputElement("UserID",i.SessionInformation.UserId)),r.appendChild(n.CreateHiddenInputElement("user_id",i.SessionInformation.UserId))),i.WopiPrecheckInfo.IrmEnabled&&r.appendChild(n.CreateHiddenInputElement("irmEnabled",i.WopiPrecheckInfo.IrmEnabled.toString())),i.WopiPrecheckInfo.SupportsDecryptedContentDownload&&r.appendChild(n.CreateHiddenInputElement("SupportsDecryptedContentDownload",i.WopiPrecheckInfo.SupportsDecryptedContentDownload.toString())),i.WopiPrecheckInfo.ViewOnly&&r.appendChild(n.CreateHiddenInputElement("ViewOnly",i.WopiPrecheckInfo.ViewOnly.toString())),i.WopiPrecheckInfo.ETag&&r.appendChild(n.CreateHiddenInputElement("ETag",i.WopiPrecheckInfo.ETag)),i.WopiPrecheckInfo.CTag&&r.appendChild(n.CreateHiddenInputElement("RevID",i.WopiPrecheckInfo.CTag)),i.WopiPrecheckInfo.DocUniqueId&&r.appendChild(n.CreateHiddenInputElement("DocID",i.WopiPrecheckInfo.DocUniqueId)),i.WopiPrecheckInfo.BundleInfo.Url&&r.appendChild(n.CreateHiddenInputElement("bundleUrl",i.WopiPrecheckInfo.BundleInfo.Url)),i.WopiPrecheckInfo.PreseededSessionKey&&!y&&r.appendChild(n.CreateHiddenInputElement("PreseededSessionKey",i.WopiPrecheckInfo.PreseededSessionKey)),i.SessionInformation.HostName&&r.appendChild(n.CreateHiddenInputElement("fileSrc",i.SessionInformation.HostName)),i.ApplicationCustomSettings&&i.ApplicationCustomSettings.HostUIControls&&r.appendChild(n.CreateHiddenInputElement("huictrls",JSON.stringify(i.ApplicationCustomSettings.HostUIControls))),BrowserUtils.SupportsTouch()&&r.appendChild(n.CreateHiddenInputElement("touchDevice","1")),window.document.documentElement&&(window.document.documentElement.clientWidth!==undefined&&r.appendChild(n.CreateHiddenInputElement("windowWidth",window.document.documentElement.clientWidth.toString())),window.document.documentElement.clientHeight!==undefined&&r.appendChild(n.CreateHiddenInputElement("windowHeight",window.document.documentElement.clientHeight.toString()))),g=UrlUtils.GetQueryStringParam("PreviousSessionID"),g&&r.appendChild(n.CreateHiddenInputElement("PreviousSessionID",g)),this.IsLocalStorageSupported()&&r.appendChild(n.CreateHiddenInputElement("LSSupported","1")),r.appendChild(n.CreateHiddenInputElement("postMessageToken",i.PostMessageToken)),(s==="teams"||s==="owa")&&r.appendChild(n.CreateHiddenInputElement("hhdr","1")),r.submit(),{IFrameElement:f,FrameCreateTime:st}}return null},n.CreateHiddenInputElement=function(n,t){var i=document.createElement("input");return i.type="hidden",i.name=n,i.value=t,i},n.prototype.validateUrlHostMatchesWindowHost=function(n){var t=document.createElement("a"),i,r;return t.href=n,i=t.port||80,r=window.location.port||80,t.hostname==window.location.hostname&&i==r},n.prototype.GetPodsUrl=function(n){var t=UrlUtils.GetQueryStringParam("wdPodsUrl");return t&&!this.validateUrlHostMatchesWindowHost(t)&&(t=""),t||(t=PPTBootstrapper.GetOnDemandServer(n,!0)),t.substr(t.length-1)!="/"&&(t+="/"),t},n.prototype.GetPopsUrl=function(n){var t=UrlUtils.GetQueryStringParam("wdPopsUrl");return t&&!this.validateUrlHostMatchesWindowHost(t)&&(t=""),t||(t=this.GetPodsUrl(n),t=t.substr(0,t.indexOf("/pods/"))),t.substr(t.length-1)!="/"&&(t+="/"),t},n.prototype.IsLocalStorageSupported=function(){var n="Test";try{return localStorage.setItem(n,n),localStorage.removeItem(n),!0}catch(t){return!1}},n.prototype.Log=function(n){this.logger.ULS.traceTag(39978262,logCategory.PptSession,logLevel.Info,n)},n.prototype.OnMessage=function(n,t){var o=this,i=n,r,u,e,f;try{if(!i||!this.m_appData){this.logger.ULS.traceTag(39978263,logCategory.PptSession,logLevel.Error,"Missing message data: "+!i+" or appData: "+!this.m_appData);return}this.m_iframe&&this.m_iframe.contentWindow==t||this.logger.ULS.traceTag(39978264,logCategory.PptSession,logLevel.Error,"Message with the right postMessageToken came from an unexpected iframe");!i.Data.officeSessionId&&this.m_appData.AppInitDiagnostics.officeSessionId&&(i.Data.officeSessionId=this.m_appData.AppInitDiagnostics.officeSessionId);i.Data.messageType||(i.Data.messageType=i.Type);this.logger.ULS.traceTag(38580691,logCategory.PptSession,logLevel.Info,JSON.stringify(i.Data));switch(i.Type){case MessageType.AppReadyForPostMessage:this.m_wopiBootParams&&(this.m_wopiBootParams.m_hasAppBooted=!0);i.Data.officeSessionId&&(this.m_appData.AppInitDiagnostics.officeSessionId=i.Data.officeSessionId);window.setTimeout(function(){return o.TryPostWopiInfo()},1);break;case MessageType.AppBootComplete:this.m_appData.InitParams.FnOnInitializeSuccess&&(this.m_appData.AppInitDiagnostics.officeBootstrapperVersion=this.GetVersion(),i.Data.officeAppEndpoint&&(this.m_appData.AppInitDiagnostics.officeAppEndpoint=i.Data.officeAppEndpoint),i.Data.officeServerVersion&&(this.m_appData.AppInitDiagnostics.officeServerVersion=i.Data.officeServerVersion),i.Data.documentLoadedTime&&(this.m_appData.AppInitDiagnostics.documentLoadedTime=i.Data.documentLoadedTime,this.m_appData.AppInitDiagnostics.appCompletedTime=i.Data.documentLoadedTime),i.Data.officeFrameFirstFlushTime&&(this.m_appData.AppInitDiagnostics.officeFrameFirstFlushTime=i.Data.officeFrameFirstFlushTime),i.Data.officeFrameDocumentFlushTime&&(this.m_appData.AppInitDiagnostics.officeFrameDocumentFlushTime=i.Data.officeFrameDocumentFlushTime),i.Data.documentFlushTime&&(this.m_appData.AppInitDiagnostics.officeFrameServerDocumentFlushTime=i.Data.documentFlushTime),i.Data.serverFirstFlushTime&&(this.m_appData.AppInitDiagnostics.officeFrameServerFirstFlushTime=i.Data.serverFirstFlushTime),i.Data.serverStartTime&&(this.m_appData.AppInitDiagnostics.officeFrameServerStartTime=i.Data.serverStartTime),i.Data.bootStartMs&&(this.m_appData.AppInitDiagnostics.officeServerDocumentProcessStartTime=i.Data.bootStartMs),i.Data.bootEndMs&&(this.m_appData.AppInitDiagnostics.officeServerDocumentProcessEndTime=i.Data.bootEndMs),i.Data.cacheHit&&(this.m_appData.AppInitDiagnostics.cacheHit=i.Data.cacheHit),r={browserRequest:!1,status:200,isAppCompleteCritical:!0,isDocumentLoadCritical:!0,name:"BootRequest"},i.Data.downloadCorrelation&&(r.correlationId=i.Data.downloadCorrelation),i.Data.downloadStartMs&&(r.startTime=i.Data.downloadStartMs),i.Data.downloadEndMs&&(r.endTime=i.Data.downloadEndMs),i.Data.downloadSize&&(r.size=i.Data.downloadSize),i.Data.incDownload&&(r.incremental=i.Data.incDownload),this.m_appData.AppInitDiagnostics.fileRequestsData=[],this.m_appData.AppInitDiagnostics.fileRequestsData.push(r),this.windowVisibilityMetrics.Stop(),u=this.windowVisibilityMetrics.GetVisibilityChangeEvents(),u&&u.length>0&&(this.m_appData.AppInitDiagnostics.documentLoadedWithTabSwitch=!0,this.logger.ULS.traceTag(38580692,logCategory.PptSession,logLevel.Info,"Visibility Change Events:"+JSON.stringify(u))),this.logger.ULS.traceTag(34932955,logCategory.PptSession,logLevel.Info,JSON.stringify(this.m_appData.AppInitDiagnostics)),f=function(){o.Dispose()},this.m_app=new PPTApplication(this.m_appData.InitParams.PostMessageToken,f,this.m_iframe,this.logger,this.m_appData.InitParams.ApplicationUrl,!!this.m_appData.InitParams.SessionInformation.SupportsAccessibilityLoop),this.m_appData.InitParams.FnOnInitializeSuccess(this.m_app,this.m_appData.AppInitDiagnostics));break;case MessageType.RefreshPage:if(this.m_appData.InitParams.ApplicationUrl.toLowerCase().indexOf("uiembed=1")>-1&&this.m_appData.InitParams.SessionInformation.SupportsDocReboot){this.m_app.TriggerDocReboot();break}e=window.location.href;i.Data.officeSessionId&&(e=UrlUtils.addOrReplaceParameterValue(e,"PreviousSessionID",i.Data.officeSessionId));window.location.href=e;break;case MessageType.UpdateInitializationComplete:f=function(){o.Dispose()};this.m_app=new PPTApplication(this.m_appData.InitParams.PostMessageToken,f,this.m_iframe,this.logger,this.m_appData.InitParams.ApplicationUrl,!!this.m_appData.InitParams.SessionInformation.SupportsAccessibilityLoop);this.m_appData.InitParams.FnOnInitializeSuccess(this.m_app,this.m_appData.AppInitDiagnostics)}}catch(s){}},n.prototype.Dispose=function(){var n=PPTMessageListenerRegistry.GetInstance();n&&this.m_appData&&n.Remove(this.m_appData.InitParams.PostMessageToken);this.m_iframe&&this.m_iframe.parentElement&&this.m_iframe.parentElement.removeChild(this.m_iframe);this.m_iframe&&delete this.m_iframe;this.m_iframe=null;this.windowVisibilityMetrics.Stop()},n.prototype.TryPostWopiInfo=function(){var i=this.m_wopiBootParams,t,r;i&&i.AreAllFieldsSet()&&(t={},t.WopiSrc=i.m_wopiInfo.WopiSrc,t.AccessToken=i.m_wopiInfo.AccessToken,t.AccessTokenTTL=!i.m_wopiInfo.AccessTokenExpiry?0:i.m_wopiInfo.AccessTokenExpiry.getTime(),t.ReadOnly=i.m_readonly,t.IrmEnabled=i.m_irmEnabled,t.SupportsDecryptedContentDownload=i.m_supportsDecryptedContentDownload,t.FileName=i.m_fileName,t.SessionContext=this.m_sessionContext,t.WdParams=this.m_wdParams,t.DocumentURL=window.location.href,r=UrlUtils.GetQueryStringParam("PreviousSessionID"),r&&(t.PreviousSessionID=r),n.SetHostPerfData(t),i.m_iframe.contentWindow.postMessage(JSON.stringify(t),i.m_podsUrl),this.m_wopiBootParams=null)},n.SetHostPerfData=function(n){var o=window.self.WOPIPerf_FirstPageFlush,r,u,f,e,t,i;o&&(n.FirstPageFlushTime=o);r=window.self.WOPIPerf_BootJsStartTime;r&&(n.BootJsStartTime=r);u=window.self.WOPIPerf_BootJsEndTime;u&&(n.BootJsEndTime=u);f=window.self.WOPIPerf_InitializeWac;f&&(n.InitializeWacTime=f);e=window.self.WOPIPerf_UserClick;e&&(n.UserClickTime=e);window.performance&&(t=window.performance.timing,t&&(n.NavigationStart=t.navigationStart,n.FetchStart=t.fetchStart,n.RequestStart=t.requestStart,n.ResponseStart=t.responseStart,n.ResponseEnd=t.responseEnd),i=window.performance.navigation,i&&(n.NavigationType=i.type,n.NavigationRedirects=i.redirectCount))},n.GetWacFallbackUrl=function(n,t){var r,u,f,i;return n.WopiSrc.indexOf("PowerPointFrame.aspx")>=0&&(r=n.WopiSrc.substr(n.WopiSrc.indexOf("WOPISrc=")+8),u=r.indexOf("&"),n.WopiSrc=u<0?decodeURIComponent(decodeURI(r)):decodeURIComponent(r.substring(0,u))),f=t.ApplicationUrl.indexOf("?"),i=t.ApplicationUrl.substring(0,f),i+="?wdEnableRoaming=1&wdo=1",i=UrlUtils.addOrReplaceParameterValue(i,"PowerPointView",UrlUtils.getParameterValue(t.ApplicationUrl,"PowerPointView")),t.ApplicationUrl.toLowerCase().indexOf("new=1")>=0&&(i=UrlUtils.addOrReplaceParameterValue(i,"New","1")),t.ApplicationUrl.indexOf("Embed=1")>=0&&(i=UrlUtils.addOrReplaceParameterValue(i,"Embed","1")),t.ApplicationCustomSettings&&t.ApplicationCustomSettings.OnDemandServer==""&&(i=UrlUtils.addOrReplaceParameterValue(i,"noLog","True")),n.WopiSrc&&(i=UrlUtils.addOrReplaceParameterValue(i,"WOPISrc",UrlUtils.UrlKeyValueEncode(n.WopiSrc))),UrlOverrideUtils.UpdateOverride(i)},n.prototype.UpdateBrowserHistoryForCreateNew=function(n){if(n&&n.NewFilePath)window.history.replaceState(null,"",n.NewFilePath),n.UpdatedPageTitle&&(window.document.title=n.UpdatedPageTitle);else if(window.location.href.indexOf("action=editnew")>=0){var t=window.location.href.replace("action=editnew","action=edit");window.history.replaceState(null,window.document.title||"",t)}},n.prototype.OnWopiInfoReceived=function(n,t,i){var r=this;this.m_wopiBootParams&&(this.m_wopiBootParams.m_wopiInfo=n);t==CreateNewScenario.UnifiedCreateNew&&(i?this.UpdateBrowserHistoryForCreateNew(i):this.UpdateBrowserHistoryForCreateNew());window.setTimeout(function(){return r.TryPostWopiInfo()},1)},n.prototype.FWdPopOrPodParam=function(n){return n.toLocaleLowerCase().indexOf("pod")>=0||n.toLocaleLowerCase().indexOf("pop")>=0?!0:!1},n.prototype.GetWopiPendingApplication=function(){return this.m_wopiPendingApplication},n}(),PPTUnifiedBootstrapper=function(){function n(){}return n.prototype.GetVersion=function(){return BuildVersionConfig.BUILD_NUMBER},n.prototype.GetMinContentVersion=function(){return 1},n.prototype.Prefetch=function(){},n.prototype.InitializeWopiPending=function(n){var t=new PPTUnifiedSessionLoader(n);return t.GetWopiPendingApplication()},n}();Microsoft.Office.PowerPoint.Application=new PPTUnifiedBootstrapper;var PPTDisabledApplication=function(){function n(n){this.m_sessionId=n}return n.prototype.GetApplicationType=function(){return"PowerPoint"},n.prototype.GetVersion=function(){return BuildVersionConfig.BUILD_NUMBER},n.prototype.GetSessionId=function(){return this.m_sessionId},n.prototype.RegisterEventHandler=function(){},n.prototype.RemoveEventHandler=function(){},n.prototype.RegisterErrorHandler=function(){},n.prototype.RemoveErrorHandler=function(){},n.prototype.AddEventHandler=function(){},n.prototype.dispose=function(){},n.prototype.Dispose=function(){},n.prototype.GetIsDisabled=function(){return!0},n.prototype.GetPercievedBoot=function(){return null},n.prototype.UsingCached=function(){return!1},n.prototype.GetCurrentSlideDimensions=function(){},n.prototype.GetSlidesInShowCount=function(){},n.prototype.GetTimeLineInfos=function(){},n.prototype.GetCurrentPosition=function(){},n.prototype.GetId=function(){},n.prototype.Next=function(){},n.prototype.PausePresentation=function(){},n.prototype.PlayPresentation=function(){},n.prototype.GetPresentationPlaybackState=function(){},n.prototype.NextSlide=function(){},n.prototype.Prev=function(){},n.prototype.PrevSlide=function(){},n.prototype.GoToNextSlide=function(){},n.prototype.GoToPrevSlide=function(){},n.prototype.GoToSlide=function(){},n.prototype.GoToSlideId=function(){},n.prototype.DisplayBlackSlide=function(){},n.prototype.DisplayWhiteSlide=function(){},n.prototype.Popout=function(){},n.prototype.PlayMedia=function(){},n.prototype.PauseMedia=function(){},n.prototype.RestoreFocus=function(){},n.prototype.StopMedia=function(){},n.prototype.SeekMedia=function(){},n.prototype.GetCurrentMediaStates=function(){},n.prototype.SetNavigationOptions=function(){},n}(),TimeoutWrapper=function(){function n(n,t){var i=this,r,u;this.m_initialTicks=0;this.m_onSuccessTicks=0;this.m_onFailureTicks=0;this.m_onTimeoutTicks=0;this.m_fCallbackCalled=!1;this.m_callbackTimeoutError={errorType:ApplicationErrors.AppInitError,errorObject:"Timed out waiting for FnOnInitializeSuccess",Category:0,Code:5,EventType:13,ExtraInfo:"Initialization timeout"};n&&(n.FnOnInitializeSuccess&&(r=n.FnOnInitializeSuccess,n.FnOnInitializeSuccess=function(n,u){i.m_onSuccessTicks=Date.now();i.m_fCallbackCalled||(i.m_fCallbackCalled=!0,i.m_onTimeoutTicks?i.LogCallbackArrivedAfterTimeout("success",u,t):(t&&t.ULS.traceTag(38836226,logCategory.PptSession,logLevel.Info,"TimeoutWrapper: Calling fnOnInitializeSuccess"),r(n,u)))}),n.FnOnInitializeFailure&&(u=n.FnOnInitializeFailure,n.FnOnInitializeFailure=function(n,r){i.m_onFailureTicks=Date.now();i.m_fCallbackCalled||(i.m_fCallbackCalled=!0,i.m_onTimeoutTicks&&n!=i.m_callbackTimeoutError?i.LogCallbackArrivedAfterTimeout("failure",r,t,n):(t&&t.ULS.traceTag(38836227,logCategory.PptSession,logLevel.Info,"TimeoutWrapper: Calling fnOnInitializeFailure"),u(n,r)))}));this.TryStartTimeout(n,t)}return n.AddTimeoutWrappersToHostCallbacks=function(t,i){new n(t,i)},n.prototype.TryStartTimeout=function(n,t){var u=this,r,i;this.m_initialTicks=Date.now();r=Configuration.HostCallbackTimeout;i=UrlUtils.GetQueryStringParam("wdOnSuccessTimeout");!i||parseInt(i).toString()!=i||(r=parseInt(i));r&&window.setTimeout(function(){return u.TimeoutIfSuccessNotCalled(n,t)},r)},n.prototype.LogCallbackArrivedAfterTimeout=function(n,t,i,r){var u={};u.Message="Received "+n+" callback after timeout had elapsed";u.timeoutTimeMs=this.m_onTimeoutTicks;u.successTimeMs=this.m_onSuccessTicks;u.startTimeMs=this.m_initialTicks;u.appInitDiagnostics=t;r&&(u.error=r);i&&i.ULS.traceTag(38589660,logCategory.PptSession,logLevel.Info,JSON.stringify(u))},n.prototype.TimeoutIfSuccessNotCalled=function(n,t){this.m_onFailureTicks||this.m_onSuccessTicks||this.m_onTimeoutTicks||(this.m_onTimeoutTicks=Date.now(),n.FnOnInitializeFailure&&n.FnOnInitializeFailure(this.m_callbackTimeoutError),t&&t.ULS.traceTag(38589661,logCategory.PptSession,logLevel.Error,"Timed out waiting for FnOnInitializeSuccess to be called. startMs:"+this.m_initialTicks+", timeoutMs:"+this.m_onTimeoutTicks))},n}(),PPTBootstrapSettings=function(){function n(){}return n.getAppMetadata=function(){return{AppVersionMajor:1,AppVersionMinor:BuildVersionConfig.BUILD_NUMBER_MINOR,ContentVersionMajor:1,ContentVersionMinor:BuildVersionConfig.BUILD_NUMBER_MINOR,WacCdnVersion:BuildVersionConfig.BUILD_CDN_NUMBER,Environment:"wac"}},n.getCDNManifestMapping=function(){var n={};return n["pptscripts/reader.dione.js"]="pptscripts/050460f470305ca0.js",n["pptscripts/reader.calypso.js"]="pptscripts/9cfe1ed61b160674.js",n["pptscripts/babylon.js"]="pptscripts/d942fcaf3b4268b7.js",n["pptpages/powerpointframe.html"]="pptpages/e67a18389135329b.html",n["pptscripts/powerpoint.boot.vslice.js"]="pptscripts/5a7a7abd8a842649.js",n},n.viewerSliceBootstrapper=function(){return"https://contentstorage.osi.office.net/scripts/pptscripts/5a7a7abd8a842649.js"},n}(),PPTPreviewerBootstrapper=function(){function n(){}return n.TryLoadSlice=function(n,t,i){var r,u,e,f;try{return r=PPTBootstrapSettings.getAppMetadata(),u=PPTBootstrapSettings.viewerSliceBootstrapper(),r&&r.Environment=="wac"&&(e=PPTBootstrapper.GetWacStaticResourcesServer(n,t,i),u=e+r.WacCdnVersion+"_pptscripts/powerpoint.boot.vslice.js"),f=document.createElement("script"),f.src=u,document.head.insertBefore(f,document.head.firstChild),!0}catch(o){return!1}},n.CreateSession=function(n){return PodsSessionFactory.CreateSession(n)},n.prototype.InitializeWopiPending=function(t){var p=n.TryLoadSlice(t.ApplicationCustomSettings,t.ApplicationUrl,t.BootstrapperUrl),i=undefined,a,s,v,f,r,u,h,c,l,e,o;try{return a=t.SessionInformation.HostSessionId,t.ApplicationCustomSettings&&t.ApplicationCustomSettings.ForceHttp||(t.SessionInformation.HostSessionId=PPTBootstrapper.GenerateRandomUUID()),t=PPTBootstrapper.EnsureInitializeParametersAreTheRightType(t),t.ApplicationCustomSettings=n.InitAppSettingsWithDefaults(t.ApplicationCustomSettings),t.WopiPrecheckInfo.BundleInfo&&t.WopiPrecheckInfo.BundleInfo.Url||(t.WopiPrecheckInfo.BundleInfo=new ContentBundleParameters),s=PPTBootstrapper.GetOnDemandServer(t),i=ULS.getLogger(t.SessionInformation.HostSessionId,s+"RemoteUls.ashx"),i.ULS.traceTag(38286563,logCategory.PptSession,logLevel.Info,"Bootstrap - initializing session. Build version: "+this.GetVersion()),i.ULS.traceTag(40206739,logCategory.PptSession,logLevel.Info,"Bootstrap - initializing session. Slice load initated: "+p),i.ULS.traceTag(38286592,logCategory.PptSession,logLevel.Info,"Bootstrapper Init Time: "+(new Date).getTime()),TimeoutWrapper.AddTimeoutWrappersToHostCallbacks(t,i),v=new WindowVisibilityMetrics,this.windowVisibilityMetrics=v,f=PPTBootstrapper.GetPostMessageToken(t.SessionInformation.HostSessionId),t.PostMessageToken=f,r=n.ShouldUsePODS(t,i),n.LogShouldUsePodsOrCachedResult(r,t.ApplicationUrl,r.Reason,i),u={},u.PostMessageToken=f,u.UsePODSDetails=r,u.HostSessionId=a,h=t,r.ShouldUsePODS||(u.FallbackPreBoot=!0,h=n.SanitizeInputParametersForFallbackLog(t)),PPTBootstrapper.SendInitialLog(h,"Previewer",u,i),r.ShouldUsePODS?(t.ApplicationCustomSettings.OnDemandServer=s,l=PPTBootstrapSettings.getAppMetadata(),l&&l.Environment=="wac"&&(t.ApplicationCustomSettings.WacStaticResourcesServer=PPTBootstrapper.GetWacStaticResourcesServer(t.ApplicationCustomSettings,t.ApplicationUrl,t.BootstrapperUrl)),(window.location.search.indexOf("wdTestPreviewer")>=0||window.location.hash.indexOf("wdTestPreviewer")>=0)&&(t.WopiPrecheckInfo.BundleInfo.Url=undefined),n.CreateViewer(t,i),PPTBootstrapper.logBootstrapperPerformanceInfo(t.BootstrapperUrl,"PreviewerTSBoot",i),window.setTimeout(function(){i&&i.ULS.flush()},1e4),{Complete:function(){},Fail:function(r){n.WopiPendingFail(t.SessionInformation.HostSessionId,r,i)}}):(i.ULS.traceTag(38836228,logCategory.PptSession,logLevel.Info,"Previewer unsupported region"),e=void 0,t.ApplicationCustomSettings&&t.ApplicationCustomSettings.EnableWacFallback&&t.ApplicationUrl?(i.ULS.traceTag(38836229,logCategory.PptSession,logLevel.Info,"Previewer setting up wacFallbackController"),c=new WacFallbackController(t,!0,function(t,i){return n.GetWacPreviewURL(t,i)},null,i,this.windowVisibilityMetrics,f),e={Complete:function(n,t){c.WopiPendingApplicationComplete(n,t)},Fail:function(n){c.WopiPendingApplicationFail(n)}}):(i.ULS.traceTag(38836230,logCategory.PptSession,logLevel.Info,"Previewer returning error for unsupported region"),o={errorType:ApplicationErrors.AppInitError,errorObject:"Region not suppported",Category:0,Code:6,EventType:13,ExtraInfo:"Region not suppported"},t.FnOnInitializeFailure(o),e={Complete:function(){},Fail:function(r){n.WopiPendingFail(t.SessionInformation.HostSessionId,r,i)}}),e)}catch(y){i&&(i.ULS.traceTag(38286593,logCategory.PptSession,logLevel.Error,ApplicationErrors.AppInitError+": "+JSON.stringify(y)),i.ULS.flushOnClose());o={errorType:ApplicationErrors.AppInitError,errorObject:y,Category:0,Code:1,EventType:13,ExtraInfo:"Exception caught"};t.FnOnInitializeFailure(o)}return undefined},n.InitAppSettingsWithDefaults=function(n){return n||(n={}),n.AddShadowBorder=n.AddShadowBorder!=undefined?n.AddShadowBorder:!1,n.EnableAdvanceOnClick=n.EnableAdvanceOnClick!=undefined?n.EnableAdvanceOnClick:!0,n.EnableAutoAdvance=n.EnableAutoAdvance!=undefined?n.EnableAutoAdvance:!0,n.EnableKeyboardNavigation=n.EnableKeyboardNavigation!=undefined?n.EnableKeyboardNavigation:!0,n.EnableWacFallback=n.EnableWacFallback!=undefined?n.EnableWacFallback:!0,n.ForceHttp=n.ForceHttp!=undefined?n.ForceHttp:!1,n.PreserveDrawingBuffer=n.PreserveDrawingBuffer!=undefined?n.PreserveDrawingBuffer:!1,n.TakeFocusOnBoot=n.TakeFocusOnBoot!=undefined?n.TakeFocusOnBoot:!0,n.UseTransparentBackground=n.UseTransparentBackground!=undefined?n.UseTransparentBackground:!0,n.EnableAdvanceOnTap=n.EnableAdvanceOnTap!=undefined?n.EnableAdvanceOnTap:!1,n},n.WopiPendingFail=function(t,i,r){var u=i,e=u==null?"":u.message,f;r.ULS.traceTag(38286594,logCategory.PptSession,logLevel.Warning,"WopiPendingFail - message"+e);f=u==null?!1:u.shutdownApp==!0;f&&n.CleanupWopiPending(t)},n.CleanupWopiPending=function(n){var i=PPTMessageListenerRegistry.GetInstance(),t=i.Get(n);t&&t.Dispose()},n.SanitizeInputParametersForFallbackLog=function(n){return{BootstrapperUrl:n.BootstrapperUrl,Container:n.Container,PostMessageToken:n.PostMessageToken,SessionInformation:{HostName:n.SessionInformation.HostName,HostSessionId:n.SessionInformation.HostSessionId,UserId:""},ApplicationUrl:n.ApplicationUrl,WopiPrecheckInfo:{FileName:""},ApplicationCustomSettings:n.ApplicationCustomSettings,Diagnostics:n.Diagnostics,FnOnInitializeSuccess:n.FnOnInitializeSuccess,FnOnInitializeFailure:n.FnOnInitializeFailure}},n.ShouldUsePODS=function(n,t){var i=PPTBootstrapper.InferFileNewFromWopiPrecheckInfo(n.WopiPrecheckInfo,n.ApplicationUrl,t);return window.location.search.indexOf("wdTestWac=1")>=0||window.location.search.indexOf("wdTestWac=1")>=0?new UsePODSDetails(!1,!1,"wdTestWac set to true in Host Page URL",i):n.ApplicationCustomSettings&&n.ApplicationCustomSettings.OnDemandServer?new UsePODSDetails(!0,!0,"OnDemandServer provided by Host",i):!n.ApplicationUrl&&n.SessionInformation.HostName!="MSTeams"&&n.SessionInformation.HostName!="TeamsiOS"&&n.SessionInformation.HostName!="apiTest"&&n.SessionInformation.HostName!="TeamsAndroid"?new UsePODSDetails(!1,!1,"No Application URL provided (Sharepoint)",i):n.ApplicationUrl?!n.WopiPrecheckInfo.FileGetUrl&&n.WopiPrecheckInfo.BundleInfo.Url?new UsePODSDetails(!0,!0,"No FileGetUrl was provided but a cached bundle URL was",i):window.location.search.indexOf("wdTestPreviewer=1")>=0||window.location.hash.indexOf("wdTestPreviewer=1")>=0?new UsePODSDetails(!0,!0,"wdTestPreviewer set to true in Host Page URL",i):PPTBootstrapper.PODSFlighting(n,!1,t):new UsePODSDetails(!0,!0,"No Application URL provided",i)},n.LogShouldUsePodsOrCachedResult=function(n,t,i,r){var u={};u.ShouldUsePods=n.ShouldUsePODS;u.CanUsePods=n.CanUsePODS;u.ApplicationUrl=PPTBootstrapper.ExtractHostname(t);u.Reason=i;r.ULS.traceTag(38286595,logCategory.PptSession,logLevel.Info,JSON.stringify(u))},n.GetWacPreviewURL=function(n,t){var r,u,f,i;return n.WopiSrc.indexOf("PowerPointFrame.aspx")>=0&&(r=n.WopiSrc.substr(n.WopiSrc.indexOf("WOPISrc=")+8),u=r.indexOf("&"),n.WopiSrc=u<0?decodeURIComponent(decodeURI(r)):decodeURIComponent(r.substring(0,u))),f=t.ApplicationUrl.indexOf("?"),i=t.ApplicationUrl.substring(0,f),i+="?PowerPointView=ReadingView&wdnc=1&wdEnableRoaming=1&wdo=1",i=PPTBootstrapper.AppendCommonFrameUrlQueryParams(i,t),PPTBootstrapper.AppendCommonFallbackQueryParams(i,t,n.WopiSrc)},n.FPreviewerThroughPodsEnabled=function(t){if(t.ApplicationUrl.indexOf("https://FFC-powerpoint.officeapps.live.com")==0)return!0;if(t.SessionInformation.HostName.indexOf("Teams")>=0)return!1;var i=PPTBootstrapper.GetFlightingNumber(t);return i<n.EnableCachedFragmentsThroughPodsPercent?!0:!1},n.prototype.InitializePodsExisting=function(t){var o=n.TryLoadSlice(t.ApplicationCustomSettings,t.ApplicationUrl,t.BootstrapperUrl),i,r,u,f,e;t.WopiPrecheckInfo.BundleInfo||(t.WopiPrecheckInfo.BundleInfo=new ContentBundleParameters);t.ApplicationCustomSettings=n.InitAppSettingsWithDefaults(t.ApplicationCustomSettings);t.ApplicationCustomSettings.OnDemandServer||window.location.href&&(t.ApplicationCustomSettings.OnDemandServer=window.location.href.split("SlideShowFrame.html")[0]);i=undefined;i=ULS.getLogger(t.SessionInformation.HostSessionId,t.ApplicationCustomSettings.OnDemandServer+"RemoteUls.ashx");i.ULS.traceTag(40206740,logCategory.PptSession,logLevel.Info,"Bootstrap - initializing PodsExisting. Slice load initated: "+o);PPTBootstrapper.SendInitialLog(t,"Slide Show",null,i);r=PPTBootstrapSettings.getAppMetadata();r&&r.Environment=="wac"&&(t.ApplicationCustomSettings.WacStaticResourcesServer=PPTBootstrapper.GetWacStaticResourcesServer(t.ApplicationCustomSettings,t.ApplicationUrl,t.BootstrapperUrl));u={};u.podsSessionId=t.WopiPrecheckInfo.PodSessionId;i.ULS.traceTag(38540374,logCategory.PptSession,logLevel.Info,JSON.stringify(u));f=PPTMessageListenerRegistry.GetInstance().Get(t.SessionInformation.HostSessionId);f&&(i.ULS.traceTag(39416217,logCategory.PptSession,logLevel.Error,"InitializePodsExisting found a session already created for this id. Disposing it"),f.DisposePreloadedApp());e=new PreviewSessionLoader(t,i,r);e.LoadApp(t.WopiPrecheckInfo.PodSessionId,!1);e.LaunchFromSlide({PresentationId:t.WopiPrecheckInfo.PodSessionId,StartingSlideId:t.ApplicationCustomSettings.StartingSlideId,StartingSlideIndex:t.ApplicationCustomSettings.StartingSlideIndex,Diagnostics:t.Diagnostics,SendInitialLog:!1});PPTBootstrapper.logBootstrapperPerformanceInfo(t.BootstrapperUrl,"InitializePodsExisting",i)},n.prototype.PreloadApp=function(t){var e=(new Date).getTime(),o=n.TryLoadSlice(t.ApplicationCustomSettings,t.ApplicationUrl,t.BootstrapperUrl),i,r,f,u;return t.WopiPrecheckInfo.BundleInfo||(t.WopiPrecheckInfo.BundleInfo=new ContentBundleParameters),t.ApplicationCustomSettings=n.InitAppSettingsWithDefaults(t.ApplicationCustomSettings),i=undefined,i=ULS.getLogger(t.SessionInformation.HostSessionId,t.ApplicationCustomSettings.OnDemandServer+"RemoteUls.ashx"),i.ULS.traceTag(40206741,logCategory.PptSession,logLevel.Info,"Bootstrap - initializing session. Slice load initated: "+o),PPTBootstrapper.SendInitialLog(t,"Preload App",null,i),r=PPTBootstrapSettings.getAppMetadata(),r&&r.Environment=="wac"&&(t.ApplicationCustomSettings.WacStaticResourcesServer=PPTBootstrapper.GetWacStaticResourcesServer(t.ApplicationCustomSettings,t.ApplicationUrl,t.BootstrapperUrl)),f=new PreviewSessionLoader(t,i,r),f.LoadApp(null,!0),u={},u.PreloadAppFunctionStart=e,u.PreloadAppFunctionEnd=(new Date).getTime(),i.ULS.traceTag(38286596,logCategory.PptSession,logLevel.Info,JSON.stringify(u,PPTBootstrapper.UndefinedReplacer)),PPTBootstrapper.logBootstrapperPerformanceInfo(t.BootstrapperUrl,"PreloadApp",i),f},n.prototype.GetVersion=function(){return BuildVersionConfig.BUILD_NUMBER},n.GetMinContentVersion=function(){return 1},n.Prefetch=function(t){n.PrefetchRequiredOnly(t,["pptscripts/reader.dione.js","powerpoint.boot.js","pptscripts/powerpoint.boot.vslice.js"])},n.PrefetchRequiredOnly=function(t,i){var r=["powerpointframe.html"],u=PPTBootstrapSettings.getAppMetadata(),f;t&&u&&u.Environment!="wac"&&r.push("AppMetadata.js");f=r.concat(i);n.PrefetchSpecifiedResources(t,f)},n.PrefetchSpecifiedResources=function(t,i){var r=PPTBootstrapSettings.getAppMetadata(),f,u;if(r&&(r.Environment=="int"||r.Environment=="edog"||r.Environment=="prod"))f=PPTBootstrapSettings.getCDNManifestMapping(),i.forEach(function(t){t=="powerpointframe.html"?n.CreatePrefetchLink("https://contentstorage.osi.office.net/pages/"+f["pptpages/powerpointframe.html"]+"#powerpointframe.html"):t=="powerpoint.boot.js"?n.CreatePrefetchLink("https://contentstorage.osi.office.net/boot/powerpoint.boot.js"):n.CreatePrefetchLink("https://contentstorage.osi.office.net/scripts/"+f[t]+"#"+t.split("//").pop())});else{if(u=null,r&&r.Environment=="wac")u=PPTBootstrapper.GetWacStaticResourcesServer(null,null,t?t.BootstrapperUrl:null)+r.WacCdnVersion+"_slideshowresources/";else if(t&&t.AppBundleParameters&&t.AppBundleParameters.appBundleCustomUrl)u=t.AppBundleParameters.appBundleCustomUrl;else throw Error("Error: Prefetch using custom hosting requires prefetchParameters be provided");i.forEach(function(t){n.CreatePrefetchLink(u+t)})}},n.CreatePrefetchLink=function(n){var t=document.createElement("link");t.rel="prefetch";t.href=n;document.getElementsByTagName("head")[0].appendChild(t)},n.CreateViewer=function(t,i){var u=PPTBootstrapSettings.getAppMetadata(),f=u&&u.AppVersionMajor!=t.WopiPrecheckInfo.BundleInfo.MajorVersion,e=BrowserUtils.BrowserSupportsRenderingSVGInWebGL(),v,o,s;if((f||!e)&&(i.ULS.traceTag(38540375,logCategory.PptSession,logLevel.Info,"AppVersionMajor and ContentVersionMajor version mismatch: "+f+", or browser does not support SVG in WebGL: "+!e),t.WopiPrecheckInfo.BundleInfo.Url=undefined,!t.WopiPrecheckInfo.FileGetUrl)){t.FnOnInitializeFailure({errorType:ApplicationErrors.AppInitError,errorObject:"AppVersionMajor and ContentVersionMajor version mismatch: "+f+", or browser does not support SVG in WebGL: "+!e});return}if(!t.WopiPrecheckInfo.BundleInfo.Url&&!t.WopiPrecheckInfo.FileGetUrl){t.FnOnInitializeFailure({errorType:ApplicationErrors.AppInitError,errorObject:"Neither wopiPrecheckInfo.FileGetUrl or wopiPrecheckInfo.BundleInfo.Url provided"});return}if(!t.Container){t.FnOnInitializeFailure({errorType:ApplicationErrors.AppInitError,errorObject:"Container"});return}var h=BrowserUtils.DevicePixelRatio(),c=t.ApplicationCustomSettings.AddShadowBorder?10:0,l=t.Container.getBoundingClientRect(),y=Math.round(h*Math.max(Math.ceil(l.width),300)-2*c),p=Math.round(h*Math.max(Math.ceil(l.height),201)-2*c),r=t.SessionInformation.HostSessionId,a=n.FPreviewerThroughPodsEnabled(t);(!t.WopiPrecheckInfo.BundleInfo.Url||a)&&(v={FileName:t.WopiPrecheckInfo.FileName,FileUrl:t.WopiPrecheckInfo.FileGetUrl,FileSize:t.WopiPrecheckInfo.FileSize,OnDemandServer:t.ApplicationCustomSettings.OnDemandServer,AvailableWidth:y,AvailableHeight:p,UserSessionId:t.SessionInformation.HostSessionId,FRenderSlideShow:!0,wrsBundleUrl:t.WopiPrecheckInfo.BundleInfo.Url,WdOverrides:UrlUtils.getParameterValue(window.location.search,"wdoverrides"),DocId:t.WopiPrecheckInfo.DocUniqueId,ETag:t.WopiPrecheckInfo.ETag},r=PodsSessionFactory.CreateSession(v),o={},o.podsSessionId=r,i.ULS.traceTag(38540376,logCategory.PptSession,logLevel.Info,JSON.stringify(o)));a&&t.WopiPrecheckInfo.BundleInfo&&(t.WopiPrecheckInfo.BundleInfo.Url=undefined,i.ULS.traceTag(38540377,logCategory.PptSession,logLevel.Info,"Cleared bundle info url"));s=new PreviewSessionLoader(t,i,u);s.LoadApp(r,!1);s.LaunchFromSlide({PresentationId:r,StartingSlideId:t.ApplicationCustomSettings.StartingSlideId,StartingSlideIndex:t.ApplicationCustomSettings.StartingSlideIndex,Diagnostics:t.Diagnostics,SendInitialLog:!1})},n.EnableCachedFragmentsThroughPodsPercent=0,n}();Microsoft.Office.PowerPoint.Bootstrap=new PPTPreviewerBootstrapper;Microsoft.Office.PowerPoint.Bootstrap.Prefetch=PPTPreviewerBootstrapper.Prefetch;Microsoft.Office.PowerPoint.Bootstrap.GetMinContentVersion=PPTPreviewerBootstrapper.GetMinContentVersion;var PodsSessionFactory=function(){function n(){}return n.CreateSession=function(t){var f,r,i,u;if(t.FileName==null)throw Error("FileName");if(t.FileUrl==null)throw Error("FileUrl");if(t.AvailableWidth==null)throw Error("AvailableWidth");if(t.AvailableHeight==null)throw Error("AvailableHeight");return f=MathHelper.Hash(t.FileUrl),r=t.SessionId,r==undefined&&(r=n.GenerateSessionId(t.FileUrl)),i=t.OnDemandServer+"PodHandler.ashx?action=CreateSession&PodSID="+encodeURIComponent(r)+"&fn="+encodeURIComponent(t.FileName)+"&fileLengthHint="+t.FileSize+"&sw="+t.AvailableWidth+"&sh="+t.AvailableHeight+"&frss="+(t.FRenderSlideShow!=null?t.FRenderSlideShow.toString():"True")+"&fu="+encodeURIComponent(t.FileUrl)+"&usid="+encodeURIComponent(t.UserSessionId)+"&fuLength="+t.FileUrl.length.toString()+"&fuHash="+f.toString(),t.wrsBundleUrl!=undefined&&(i=i+"&wrsBundleUrl="+encodeURIComponent(t.wrsBundleUrl.toString())),t.WdOverrides!=undefined&&(i=i+"&wdoverrides="+encodeURIComponent(t.WdOverrides.toString())),t.DocId!=undefined&&(i=i+"&DocID="+encodeURIComponent(t.DocId)),t.ETag!=undefined&&(i=i+"&ETag="+encodeURIComponent(t.ETag)),u=new XMLHttpRequest,u.open("GET",i,!0),u.setRequestHeader("X-SupportSVGInWebGL",BrowserUtils.BrowserSupportsRenderingSVGInWebGL()?"1":"0"),u.send(null),r},n.GenerateSessionId=function(n){var f=4,i=new Uint32Array(f),r,u,t;if(window.self.crypto&&window.self.crypto.getRandomValues?window.self.crypto.getRandomValues(i):window.msCrypto&&window.msCrypto.getRandomValues&&window.msCrypto.getRandomValues(i),r="",i[0]!=0)for(u=[].slice.call(i),t=0;t<u.length;t++)r+=u[t].toString(36);else for(t=0;t<f;t++)r=Math.random().toString(36).substring(2,25);return"_._._."+r+SHA1.GenerateSHA1(n)+"-.-.-."},n}(),PPTInitializeError=function(){function n(){}return n}(),PreviewSessionLoader=function(){function n(t,i,r){if(this.m_startingSlideId=-1,this.m_startingSlideIndex=-1,this.m_bootTimingDict={},this.m_appInitDiagnostics=undefined,this.m_disposed=!1,this.m_iframeReadyForPostMessage=!1,this.m_contentPreloadId="contentPreloaded",this.m_appResourcesId="appResourcesPreloaded",this.m_iframeLoadTimeout=undefined,this.c_iframeLoaded="iframeLoaded",this.c_contentMetadataLoadedOrDoesNotExist="contentMetadataLoaded",this.c_preloadingComplete="preloadingComplete",this.c_activated="activated",this.c_minHeight=100,this.c_minIframeHeight=100,!t)throw Error("initParams is null");if(!t.SessionInformation.HostSessionId)throw Error("sessionId is null");this.m_apiId=t.SessionInformation.HostSessionId;this.m_appMetaData=r;this.m_apiStartTime=Date.now();this.m_logger=i;t.ApplicationCustomSettings&&!t.ApplicationCustomSettings.OnDemandServer&&(t.ApplicationCustomSettings.OnDemandServer=PPTBootstrapper.GetOnDemandServer(null));this.m_initParams=t;this.m_anchor=t.Container;t.ApplicationCustomSettings&&(this.m_fVariableWidth=!n.FIsUintValid(t.ApplicationCustomSettings.Width),this.m_fVariableHeight=!n.FIsUintValid(t.ApplicationCustomSettings.Height),this.m_startingSlideId=t.ApplicationCustomSettings.StartingSlideId||-1,this.m_startingSlideIndex=t.ApplicationCustomSettings.StartingSlideIndex||-1);t.Diagnostics&&t.Diagnostics.userClickTime?this.m_bootTimingDict.DocumentClickTime=t.Diagnostics.userClickTime:t.SessionInformation.DocumentClickTime&&(this.m_bootTimingDict.DocumentClickTime=t.SessionInformation.DocumentClickTime);PPTMessageListenerRegistry.GetInstance().Get(this.m_apiId)&&i.ULS.traceTag(39203528,logCategory.PptSession,logLevel.Error,"PreviewSessionLoader is about to overwrite value in PPTMessageListenerRegistry");PPTMessageListenerRegistry.GetInstance().Add(this.m_apiId,this)}return n.FIsUintValid=function(n){return!(n==null||n<0||isNaN(n))},n.CreateBaseIframe=function(n){var t=document.createElement("iframe");return t.id="pptframe-"+n,t.frameBorder="0",t.style.top=HTMLHelper.toPx(0),t.style.bottom=HTMLHelper.toPx(0),t.style.left=HTMLHelper.toPx(0),t.style.right=HTMLHelper.toPx(0),t.style.width=HTMLHelper.floatToPercent(1),t.style.height=HTMLHelper.floatToPercent(1),t.setAttribute("allowfullscreen",(!0).toString()),t.setAttribute("allowTransparency",(!0).toString()),t},n.prototype.registerOnLoadEvent=function(){var n=this;this.removeIframeOnLoadEvent();this.m_onLoad=function(){return n.OnIframeLoaded()};this.m_iframe.addEventListener("load",this.m_onLoad,!1)},n.prototype.removeIframeOnLoadEvent=function(){this.m_onLoad&&this.m_iframe.removeEventListener("load",this.m_onLoad)},n.prototype.OnIframeLoaded=function(){var n=this;this.m_logger.ULS.traceTag(39416209,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::OnIframeLoaded");this.m_bootTimingDict.iFrameOnloadEventInApi=Date.now();this.m_iframeReadyForPostMessage||(this.m_iframeLoadTimeout=window.setTimeout(function(){return n.IframeLoadTimeout()},1e4))},n.prototype.IframeLoadTimeout=function(){if(this.m_iframeReadyForPostMessage){this.m_logger.ULS.traceTag(39416210,logCategory.PptSession,logLevel.Warning,"IFrameLoadTimeout called even though iframe is ready for postmessage");return}if(!this.m_apiId){this.m_logger.ULS.traceTag(39416211,logCategory.PptSession,logLevel.Warning,"IFrameLoadTimeout called after m_apiId is null");return}var n={EventType:13,Code:100,Category:0,ExtraInfo:"Timeout waiting for iframe to load",SessionId:this.m_apiId,errorType:"13",errorObject:null};this.FailToBoot(n)},n.prototype.Activate=function(){if(!this.m_apiId||!this.m_presentationId){this.m_logger.ULS.traceTag(38540363,logCategory.PptSession,logLevel.Warning,"PreviewSessionLoader::Activate is missing apiId or presentationId");return}this.m_logger.ULS.traceTag(38540364,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::Activate");(this.m_iframe==null||this.m_iframe.parentElement==null)&&this.m_logger.ULS.traceTag(39203531,logCategory.PptSession,logLevel.Error,"PreviewSessionLoader::Activate - iframe is null or detached from parent");this.m_bootTimingDict.ActivateInApi=Date.now();var n=this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EnableKeyboardNavigation?this.m_initParams.ApplicationCustomSettings.EnableKeyboardNavigation:!0,t=this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EnablePodPreviewStaticImage?!0:!1,i=this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EnableAdvanceOnTap?!0:!1;this.PostMessageDownward(new HandshakeWebViewerInternalMessage(this.m_apiId,n,this.m_contentMetadata,this.m_initParams.WopiPrecheckInfo.FileGetUrl,this.m_initParams.WopiPrecheckInfo.FileSize,this.m_initParams.WopiPrecheckInfo.FileName,this.m_presentationId,this.m_startingSlideId,this.m_startingSlideIndex,this.m_initParams.SessionInformation.HostName,this.m_initParams.Diagnostics?this.m_initParams.Diagnostics.entryPoint:"",this.m_apiStartTime,this.m_initParams.Diagnostics?this.m_initParams.Diagnostics.userClickTime?this.m_initParams.Diagnostics.userClickTime:0:0,this.m_initParams.SessionInformation.HostInitTime?this.m_initParams.SessionInformation.HostInitTime:0,t,i,this.m_initParams.Diagnostics?this.m_initParams.Diagnostics.fileHost?this.m_initParams.Diagnostics.fileHost:"":"",this.m_vetoAppSettingsStr,this.m_disabledTransitionsList));this.m_finishedBootingConditional.SetCondition(this.c_activated)},n.prototype.PostMessageDownward=function(n){var t=JSON.stringify(n);this.m_iframe&&this.m_iframe.src.length!=0?this.m_iframe.contentWindow.postMessage(t,this.m_iframe.src==""?"*":this.m_iframe.src):this.m_logger.ULS.traceTag(39203532,logCategory.PptSession,logLevel.Error,"PreviewSessionLoader::PostMessageDownward - iframe is invalid")},n.prototype.FailToBoot=function(n){this.m_logger.ULS.traceTag(38540365,logCategory.PptSession,logLevel.Error,"PreviewSessionLoader::FailToBoot: "+JSON.stringify(n));this.Dispose();this.m_initParams.FnOnInitializeFailure(n)},n.prototype.FinishBoot=function(n,t){if(!this.m_apiId||!this.m_anchor||!this.m_iframe){this.m_logger.ULS.traceTag(38540366,logCategory.PptSession,logLevel.Error,"FinishBoot is missing parameters");return}this.m_logger.ULS.traceTag(38540367,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::FinishBoot");var u=this.m_appMetaData?this.m_appMetaData.AppVersionMajor+"."+this.m_appMetaData.AppVersionMinor:"Not Ready",f=this.m_initParams.WopiPrecheckInfo.BundleInfo!=undefined&&this.m_initParams.WopiPrecheckInfo.BundleInfo.Url!=null,e=function(n){var t=PPTMessageListenerRegistry.GetInstance();t&&t.Remove(n)},i=n.GetPreviewAPIV1(this.m_anchor,this.m_iframe,this.m_apiId,f,u,t.perceivedLoadTime,e,this.m_logger),r=PPTMessageListenerRegistry.GetInstance();r.Remove(this.m_apiId);r.Add(this.m_apiId,i);this.DisposeForTransferToPreviewAPI();this.m_logger.ULS.traceTag(38540368,logCategory.PptSession,logLevel.Info,"FinishBoot - returning FnOnInitializeSuccess");this.m_initParams.FnOnInitializeSuccess(i,t)},n.prototype.OnSliceLoaded=function(){this.m_apiId&&this.m_appInitDiagnostics&&n.s_previewAPIFactory?this.FinishBoot(n.s_previewAPIFactory,this.m_appInitDiagnostics):this.m_apiId&&this.m_logger.ULS.traceTag(38540369,logCategory.PptSession,logLevel.Info,"OnSliceLoaded: App is not ready yet - "+this.m_apiId.toString())},n.prototype.Log=function(n){this.m_logger.ULS.traceTag(39978265,logCategory.PptSession,logLevel.Info,n)},n.prototype.OnMessage=function(t,i){var u,f,e,r;if(this.m_iframe&&this.m_iframe.contentWindow==i){if(t=t,!t||t.m_type==undefined){this.m_logger.ULS.traceTag(39978266,logCategory.PptSession,logLevel.Error,"PreviewSessionLoader::OnMesssage - received message with the wrong syntax");return}switch(t.m_type){case 0:this.m_logger.ULS.traceTag(38540370,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::OnMesssage - received Handshake from iframe");u=t;this.m_appInitDiagnostics={};f=u.m_percievedBootTime?new Date(u.m_percievedBootTime):undefined;this.m_appInitDiagnostics.perceivedLoadTime=f;this.m_contentMetadata||(e={HttpStatus:this.m_contentMetadataHttpStatusCode},this.m_appInitDiagnostics.errorObject={errorType:"CannotLoadBundleItem",errorObject:e});n.s_previewAPIFactory?this.FinishBoot(n.s_previewAPIFactory,this.m_appInitDiagnostics):this.m_logger.ULS.traceTag(38540371,logCategory.PptSession,logLevel.Warning,"PreviewSessionLoader::OnMesssage - Handshake received but PreviewAPIFactory is not available");break;case 10:if(r=t,!isNaN(r.m_code)&&r.m_code>=0){var s=r.m_message||"",o={EventType:13,Code:r.m_code,Category:0,ExtraInfo:r.m_extraInfo,SessionId:r.m_sessionId,errorType:"13",errorObject:null};this.FailToBoot(o)}break;case 28:this.m_bootTimingDict.AppReadyForPostMessage=Date.now();this.m_logger.ULS.traceTag(39416212,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::OnMesssage - AppReadyForPostMessage");this.m_iframeReadyForPostMessage=!0;this.m_iframeLoadTimeout&&(window.clearTimeout(this.m_iframeLoadTimeout),this.m_iframeLoadTimeout=undefined);this.m_readyToActivateConditional.SetCondition(this.c_iframeLoaded)}}},n.prototype.LoadIframe=function(t,i){if(t===void 0&&(t=null),i===void 0&&(i=!1),this.m_anchor==null||this.m_iframe==null){this.m_logger.ULS.traceTag(39416213,logCategory.PptSession,logLevel.Error,"PreviewerSessionLoader::LoadIframe is missing parameters");return}this.m_iframe.parentNode||this.m_anchor.appendChild(this.m_iframe);var u=PPTBootstrapSettings.getCDNManifestMapping(),r;this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.Url?(r=UrlUtils.HTMLEncode(this.m_initParams.ApplicationCustomSettings.Url)+"powerpointframe.html?",this.m_initParams.ApplicationCustomSettings.ExtraUrlParams&&(r=r+this.m_initParams.ApplicationCustomSettings.ExtraUrlParams)):this.m_appMetaData.Environment=="wac"?(r=this.m_initParams.ApplicationCustomSettings.WacStaticResourcesServer+this.m_appMetaData.WacCdnVersion+"_slideshowresources/powerpointframe.html",this.m_initParams.ApplicationCustomSettings.ExtraUrlParams&&(r=r+"#"+this.m_initParams.ApplicationCustomSettings.ExtraUrlParams),r=UrlUtils.addOrReplaceParameterValue(r,"wacCdnVersion",this.m_appMetaData.WacCdnVersion)):(r=UrlUtils.HTMLEncode("https://contentstorage.osi.office.net/pages/"+u["pptpages/powerpointframe.html"].toString()+"#powerpointframe.html"),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.ExtraUrlParams&&(r=r+"&"+this.m_initParams.ApplicationCustomSettings.ExtraUrlParams));(this.m_initParams.WopiPrecheckInfo.BundleInfo.Url&&this.m_initParams.WopiPrecheckInfo.BundleInfo.Url.substr(0,5)=="http:"||this.m_initParams.ApplicationCustomSettings.Url&&this.m_initParams.ApplicationCustomSettings.Url.substr(0,4)!="http"&&window.location.protocol=="http:"||this.m_initParams.ApplicationCustomSettings.OnDemandServer&&this.m_initParams.ApplicationCustomSettings.OnDemandServer.substr(0,5)=="http:"||this.m_initParams.ApplicationCustomSettings.ForceHttp)&&r.substr(0,5)=="https"&&(r=n.RelativeUrlToAbsolute(r),r="http"+r.substr(5));t&&(r=UrlUtils.addOrReplaceParameterValue(r,"pid",encodeURIComponent(t)));r=UrlUtils.addOrReplaceParameterValue(r,"PowerPointView","ChromelessView");n.FIsUintValid(this.m_startingSlideId)&&this.m_startingSlideId!=0?r=UrlUtils.addOrReplaceParameterValue(r,"wdSlideId",UrlUtils.UrlKeyValueEncode(this.m_startingSlideId.toString())):n.FIsUintValid(this.m_startingSlideIndex)&&(r=UrlUtils.addOrReplaceParameterValue(r,"wdSlideIndex",UrlUtils.UrlKeyValueEncode(this.m_startingSlideIndex.toString())));this.m_initParams.SessionInformation.DataLocale&&(r=UrlUtils.addOrReplaceParameterValue(r,"rs",this.m_initParams.SessionInformation.DataLocale));this.m_initParams.SessionInformation.UiLocale&&(r=UrlUtils.addOrReplaceParameterValue(r,"ui",this.m_initParams.SessionInformation.UiLocale));this.m_initParams.SessionInformation.HostSessionId&&(r=UrlUtils.addOrReplaceParameterValue(r,"hsi",this.m_initParams.SessionInformation.HostSessionId));r=UrlUtils.addOrReplaceParameterValue(r,"utb",UrlUtils.UrlKeyValueEncode((this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.UseTransparentBackground?this.m_initParams.ApplicationCustomSettings.UseTransparentBackground:!0).toString()));r=UrlUtils.addOrReplaceParameterValue(r,"wdEaa",UrlUtils.UrlKeyValueEncode((this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EnableAutoAdvance?1:0).toString()));r=UrlUtils.addOrReplaceParameterValue(r,"eac",UrlUtils.UrlKeyValueEncode((this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EnableAdvanceOnClick?this.m_initParams.ApplicationCustomSettings.EnableAdvanceOnClick:!0).toString()));r=UrlUtils.addOrReplaceParameterValue(r,"vm",UrlUtils.UrlKeyValueEncode((this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.ViewerMode?this.m_initParams.ApplicationCustomSettings.ViewerMode:0).toString()));r=UrlUtils.addOrReplaceParameterValue(r,"co",UrlUtils.UrlKeyValueEncode(this.m_initParams.WopiPrecheckInfo.BundleInfo.CrossOrigin?this.m_initParams.WopiPrecheckInfo.BundleInfo.CrossOrigin:"anonymous"));r=UrlUtils.addOrReplaceParameterValue(r,"lcid",UrlUtils.UrlKeyValueEncode((this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.LCID?this.m_initParams.ApplicationCustomSettings.LCID:"1033").toString()));r=UrlUtils.addOrReplaceParameterValue(r,"hostname",UrlUtils.UrlKeyValueEncode(n.GetHostName(this.m_initParams)));r=UrlUtils.addOrReplaceParameterValue(r,"ua",UrlUtils.UrlKeyValueEncode((!0).toString()));r=UrlUtils.addOrReplaceParameterValue(r,"asb",UrlUtils.UrlKeyValueEncode((this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.AddShadowBorder?this.m_initParams.ApplicationCustomSettings.AddShadowBorder:!1).toString()));r=UrlUtils.addOrReplaceParameterValue(r,"apiStartTime",UrlUtils.UrlKeyValueEncode(this.m_apiStartTime.toString()));r=UrlUtils.addOrReplaceParameterValue(r,"preloadApp",UrlUtils.UrlKeyValueEncode(i.toString()));this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.TakeFocusOnBoot&&(r=UrlUtils.addOrReplaceParameterValue(r,"takeFocusOnBoot",UrlUtils.UrlKeyValueEncode(UrlUtils.UrlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.TakeFocusOnBoot.toString()))));r=UrlUtils.addOrReplaceParameterValue(r,"isCombineRequest",UrlUtils.UrlKeyValueEncode(UrlUtils.UrlKeyValueEncode((!0).toString())));this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.NoCacheToken&&(r=UrlUtils.addOrReplaceParameterValue(r,"noCacheToken",UrlUtils.UrlKeyValueEncode(UrlUtils.UrlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.NoCacheToken))));this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EndSlideShowText&&(r=UrlUtils.addOrReplaceParameterValue(r,"endSlideShowText",UrlUtils.UrlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.EndSlideShowText)));this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.HostSupportsSessionRefreshEnabled&&(r=UrlUtils.addOrReplaceParameterValue(r,"hostSupportsSessionRefreshEnabled",UrlUtils.UrlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.HostSupportsSessionRefreshEnabled.toString())));this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.CheckIncludeTimingsFieldEnabled&&(r=UrlUtils.addOrReplaceParameterValue(r,"checkIncludeTimingsFieldEnabled",UrlUtils.UrlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.CheckIncludeTimingsFieldEnabled.toString())));this.m_appMetaData&&this.m_initParams.ApplicationCustomSettings&&!this.m_initParams.ApplicationCustomSettings.Url&&(r=UrlUtils.addOrReplaceParameterValue(r,"aVMa",UrlUtils.UrlKeyValueEncode(this.m_appMetaData.AppVersionMajor.toString())),r=UrlUtils.addOrReplaceParameterValue(r,"aVMi",UrlUtils.UrlKeyValueEncode(this.m_appMetaData.AppVersionMinor.toString())),r=UrlUtils.addOrReplaceParameterValue(r,"cVMa",UrlUtils.UrlKeyValueEncode(this.m_appMetaData.ContentVersionMajor.toString())),r=UrlUtils.addOrReplaceParameterValue(r,"cVMi",UrlUtils.UrlKeyValueEncode(this.m_appMetaData.ContentVersionMinor.toString())),r=UrlUtils.addOrReplaceParameterValue(r,"env",UrlUtils.UrlKeyValueEncode(this.m_appMetaData.Environment.toString())),r=UrlUtils.addOrReplaceParameterValue(r,"cdnMA",UrlUtils.UrlKeyValueEncode("1")),this.m_appMetaData.Environment!="wac"&&(r=UrlUtils.addOrReplaceParameterValue(r,"cdnRD",UrlUtils.UrlKeyValueEncode(u["pptscripts/reader.dione.js"].toString())),r=UrlUtils.addOrReplaceParameterValue(r,"cdnRC",UrlUtils.UrlKeyValueEncode(u["pptscripts/reader.calypso.js"].toString())),r=UrlUtils.addOrReplaceParameterValue(r,"cdnB",UrlUtils.UrlKeyValueEncode(u["pptscripts/babylon.js"].toString()))));this.m_initParams.WopiPrecheckInfo.BundleInfo.Url&&(r=UrlUtils.addOrReplaceParameterValue(r,"dce",encodeURIComponent(this.m_initParams.WopiPrecheckInfo.BundleInfo.Url)));this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.OnDemandServer&&(r=UrlUtils.addOrReplaceParameterValue(r,"odvs",this.m_initParams.ApplicationCustomSettings.OnDemandServer));r=UrlUtils.addOrReplaceParameterValue(r,"odve","podView.svc/jsonAnonymous");this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.PreserveDrawingBuffer&&(r=UrlUtils.addOrReplaceParameterValue(r,"wgl_pdb",this.m_initParams.ApplicationCustomSettings.PreserveDrawingBuffer.toString()));(window.location.search.indexOf("wdDev=1")>=0||window.location.hash.indexOf("wdDev=1")>=0)&&(r=UrlUtils.addOrReplaceParameterValue(r,"wdDev","1"));this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.WacCluster&&(r=UrlUtils.addOrReplaceParameterValue(r,"wacCluster",this.m_initParams.ApplicationCustomSettings.WacCluster));window.location.search.indexOf("wdoverrides=")>=0&&(r=UrlUtils.addOrReplaceParameterValue(r,"wdoverrides",UrlUtils.getParameterValue(window.location.search,"wdoverrides")));this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.LiveBroadcastEnabled&&(r=UrlUtils.addOrReplaceParameterValue(r,"LiveBroadcastEnabled",this.m_initParams.ApplicationCustomSettings.LiveBroadcastEnabled.toString()));r=r.replace("?","#");this.m_iframe.src=r},n.prototype.LoadApp=function(t,i){var r=this;this.m_logger.ULS.traceTag(38540372,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::LoadApp");this.m_bootTimingDict.LoadApp=Date.now();this.m_readyToActivateConditional=new ConditionalAction(function(){return r.Activate()},[this.c_iframeLoaded,this.c_contentMetadataLoadedOrDoesNotExist]);this.m_iframe=n.CreateBaseIframe(this.m_initParams.SessionInformation.HostSessionId);this.m_logger.ULS.traceTag(39203533,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::LoadApp creating new iframe - "+this.m_iframe.id.toString());this.LoadIframe(t,i);this.registerOnLoadEvent();this.m_bootTimingDict.iframeURLset=Date.now()},n.prototype.LaunchFromSlide=function(n){var r=this,t;if(!this.m_iframe){this.m_logger.ULS.traceTag(39416214,logCategory.PptSession,logLevel.Error,"PreviewSessionLoader::LaunchFromSlide iframe is null");return}this.m_logger.ULS.traceTag(39416215,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::LaunchFromSlide");this.m_initParams.ApplicationCustomSettings&&n.WacCluster&&(this.m_initParams.ApplicationCustomSettings.WacCluster=n.WacCluster);this.m_initParams.Diagnostics=n.Diagnostics;this.m_presentationId=n.PresentationId;this.m_apiStartTime=Date.now();this.m_bootTimingDict.ApiStartTime=this.m_apiStartTime;n.SendInitialLog&&PPTBootstrapper.SendInitialLog(this.m_initParams,"Slide Show",null,this.m_logger);t=this.m_presentationId;this.m_startingSlideId=n.StartingSlideId||-1;this.m_startingSlideIndex=n.StartingSlideIndex||-1;this.m_vetoAppSettingsStr=n.VetoAppSettingsStr||"";this.m_disabledTransitionsList=n.DisabledTransitionsList||"";var u=PPTBootstrapSettings.getAppMetadata(),f=PPTBootstrapSettings.getCDNManifestMapping(),i=HTMLHelper.floatToPercent(1);this.m_anchor.style.width=this.m_fVariableWidth?i:HTMLHelper.toPx(this.m_initParams.ApplicationCustomSettings.Width);this.m_anchor.style.height=this.m_fVariableHeight?i:HTMLHelper.toPx(this.m_initParams.ApplicationCustomSettings.Height);this.m_fVariableHeight&&(this.m_anchor.style.minHeight=HTMLHelper.toPx(this.c_minHeight));this.m_anchor.style.left=HTMLHelper.toPx(0);this.m_anchor.style.right=HTMLHelper.toPx(0);this.m_anchor.style.bottom=HTMLHelper.toPx(0);this.m_anchor.style.top=HTMLHelper.toPx(0);this.m_fVariableHeight?this.m_iframe.style.minHeight=HTMLHelper.toPx(this.c_minIframeHeight):this.m_iframe.style.height=HTMLHelper.toPx(Math.max(this.m_initParams.ApplicationCustomSettings.Height,0));this.m_finishedBootingConditional=new ConditionalAction(function(){return r.SendBootTelemetry()},[this.c_activated]);this.m_initParams.WopiPrecheckInfo.BundleInfo.Url?(this.GetPreviewImage(t),this.GetContentMetadata()):(this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EnablePodPreviewStaticImage&&this.m_startingSlideIndex>=1&&this.GetPreviewImageFromPods(t,this.m_startingSlideIndex),this.m_readyToActivateConditional.SetCondition(this.c_contentMetadataLoadedOrDoesNotExist))},n.prototype.SendBootTelemetry=function(){this.m_logger.ULS.traceTag(38540373,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::SendBootTelemetry");var n=new BootTimingFromApiInternalMessage(this.m_bootTimingDict);this.PostMessageDownward(n)},n.prototype.RecordStartedSlideShowTimestamp=function(n){this.m_logger.ULS.traceTag(39683465,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::RecordStartedSlideShowTimestamp Time that SlideShow started in ms: "+n);var t=new RecordStartedSlideShowTimestampInternalMessage(n);this.PostMessageDownward(t)},n.prototype.GetDataCdnEndpoint=function(){var t,n,i,r;return this.m_initParams.ApplicationCustomSettings&&this.m_initParams.WopiPrecheckInfo.BundleInfo.Url.substr(0,1)=="/"?(n=document.createElement("a"),n.href=this.m_initParams.ApplicationCustomSettings.Url,i=n.protocol,r=n.host,t=i+"//"+r+this.m_initParams.WopiPrecheckInfo.BundleInfo.Url):t=this.m_initParams.WopiPrecheckInfo.BundleInfo.Url,t},n.prototype.GetPreviewImage=function(n){var i,t;this.m_logger.ULS.traceTag(39203536,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::GetPreviewImage");i=this.m_initParams.WopiPrecheckInfo.BundleInfo.Url.indexOf("{1}")==-1?this.m_initParams.WopiPrecheckInfo.BundleInfo.Url.replace(new RegExp("\\{0\\}","gim"),"f.jpg"):this.m_initParams.WopiPrecheckInfo.BundleInfo.Url.replace(new RegExp("\\{0\\}","gim"),n).replace(new RegExp("\\{1\\}","gim"),"0").replace(new RegExp("\\{2\\}","gim"),"fullSizePreview.jpg");t=document.createElement("img");t.style.visibility="hidden";t.style.position="absolute";t.src=i},n.prototype.GetPreviewImageFromPods=function(n,t){var u,i,f,r;this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.OnDemandServer&&(this.m_logger.ULS.traceTag(39203537,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::GetPreviewImageFromPods"),u=void 0,u=this.m_initParams.ApplicationCustomSettings.OnDemandServer,i="fullSizePreview.png",t>1&&(i=t-1+"_"+i),f=void 0,f=u+"imagehandler.ashx?PV=6&PF=4&Rid="+i+"&Pid="+n,r=document.createElement("img"),r.style.visibility="hidden",r.style.position="absolute",r.src=f)},n.prototype.GetContentMetadata=function(){var i=this,t,n;this.m_logger.ULS.traceTag(39203538,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::GetContentMetadata");this.m_bootTimingDict.LoadContentMetadata_Start=Date.now();t=this.GetDataCdnEndpoint();n=new XhrRequest;n.Url=t.replace(new RegExp("\\{0\\}","gim"),"c.js");n.OnCompletedCallback=function(n){return i.OnCompletedMetadata(n)};n.State="c.js";n.Timeout=1e4;XhrHelper.GetJson(n)},n.prototype.OnCompletedMetadata=function(n){if(n.FSuccess){this.m_bootTimingDict.LoadContentMetadata_Finish=Date.now();this.m_contentMetadata=n.Data;this.m_readyToActivateConditional.SetCondition(this.c_contentMetadataLoadedOrDoesNotExist);var t={};t.ContentLength=n.ContentLength;t.ResourceStringLength=n.ResourceStringLength;t.RetriesUsed=n.RetriesUsed;t.ServerCorrelation=n.serverCorrelation;this.m_logger.ULS.traceTag(38286561,logCategory.PptSession,logLevel.Info,JSON.stringify(t))}else this.m_logger.ULS.traceTag(38286562,logCategory.PptSession,logLevel.Info,"ErrorDesription: Failed to load content metadata in api layer, HttpStatusCode: "+n.HttpStatusCode+", ID: "+n.State),this.m_contentMetadata=null,this.m_contentMetadataHttpStatusCode=n.HttpStatusCode.toString(),this.m_readyToActivateConditional.SetCondition(this.c_contentMetadataLoadedOrDoesNotExist)},n.GetHostName=function(n){return n.SessionInformation.HostName?n.SessionInformation.HostName:window.location.hostname},n.RelativeUrlToAbsolute=function(t){var i=document.createElement("div"),r;return i.innerHTML='<a href="'+n.EscapeHtml(t)+'">x<\/a>',r=i.firstChild,r.href},n.EscapeHtml=function(n){return n.split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;")},n.prototype.Dispose=function(){this.m_logger.ULS.traceTag(39203539,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::Dispose - removeAnchor: "+(this.m_anchor!=null).toString()+", removeAPI: "+(this.m_apiId!=null).toString());this.m_anchor&&this.m_anchor.parentNode&&this.m_anchor.parentNode.removeChild(this.m_anchor);this.m_apiId&&PPTMessageListenerRegistry.GetInstance().Remove(this.m_apiId);this.DisposeForTransferToPreviewAPI()},n.prototype.DisposeForTransferToPreviewAPI=function(){this.m_anchor=null;this.m_iframe=null;this.m_apiId=null},n.prototype.DisposePreloadedApp=function(){this.m_logger.ULS.traceTag(39416216,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::DisposePreloadedApp");this.m_iframe&&this.m_iframe.parentNode&&this.m_iframe.parentNode.removeChild(this.m_iframe);this.m_apiId&&PPTMessageListenerRegistry.GetInstance().Remove(this.m_apiId);this.DisposeForTransferToPreviewAPI()},n}();Microsoft.Office.PowerPoint.Bootstrap.SetPreviewAPIFactory=function(n){PreviewSessionLoader.s_previewAPIFactory=n;PPTMessageListenerRegistry.GetInstance().SetSliceLoaded()};var ConditionalAction=function(){function n(n,t){var i=this;if(this.m_conditions={},t.length==0)throw Error("conditions");this.m_action=n;t.forEach(function(n){i.m_conditions[n]=!1})}return n.prototype.SetCondition=function(n){if(this.m_conditions[n]==null)throw Error("condition");this.m_conditions[n]=!0;this.CheckConditions()},n.prototype.AddNewCondition=function(n){if(n in this.m_conditions)throw Error("condition");this.m_conditions[n]=!1},n.prototype.GetCondition=function(n){if(this.m_conditions[n]==null)throw Error("condition");return this.m_conditions[n]},n.prototype.CheckConditions=function(){var n,t;if(this.m_action!=null){n=!0;for(t in this.m_conditions)n=n&&this.m_conditions[t];n&&(this.m_action(),this.m_action=null)}},n}(),PPTMessageListenerRegistry=function(){function n(){this.m_apiRegistry={};window.addEventListener("message",this.OnMessage)}return n.GetInstance=function(){return this.s_singleton||(this.s_singleton=new n),this.s_singleton},n.prototype.Add=function(n,t){this.m_apiRegistry[n]=t},n.prototype.Get=function(n){return this.m_apiRegistry[n]},n.prototype.Remove=function(n){this.m_apiRegistry[n]=null},n.prototype.SetSliceLoaded=function(){var t,n;for(t in this.m_apiRegistry)n=this.m_apiRegistry[t],n&&n.OnSliceLoaded()},n.prototype.SendLogToAllListeners=function(n){var i,t;for(i in this.m_apiRegistry)t=this.m_apiRegistry[i],t&&t.Log(n)},n.prototype.OnMessage=function(t){var i,r,u,f;try{i=JSON.parse(t.data)}catch(e){i=null}if(i&&(r=i.m_id||i.Token,r)){if(u=n.GetInstance(),f=u.Get(r),!f){u.SendLogToAllListeners("Message received with no targetApi. Id: "+r.toString());return}f.OnMessage(i,t.source)}},n}(),WebViewerBaseMessage=function(){function n(n,t){this.m_id=n;this.m_type=t}return n}(),WebViewerBaseInternalMessage=function(){function n(n){this.m_type=n}return n}(),HandshakeWebViewerInternalMessage=function(n){function t(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){var g=n.call(this,0)||this;return g.m_id=t,g.m_fEnableKeyboardNavigation=i,g.m_contentMetadata=r,g.m_fileUrl=u,g.m_fileSize=f,g.m_fileName=e,g.m_presentationId=o,g.m_startingSlideId=s,g.m_startingSlideIndex=h,g.m_hostName=c,g.m_entryPoint=l,g.m_apiStartTime=a,g.m_documentClickTime=v,g.m_hostInitTime=y,g.m_fEnablePodPreviewStaticImage=p,g.m_fEnableAdvanceOnTap=w,g.m_fileHost=b,g.m_vetoAppSettingsStr=k,g.m_disabledTransitionsList=d,g}return __extends(t,n),t}(WebViewerBaseInternalMessage),BootTimingFromApiInternalMessage=function(n){function t(t){var i=n.call(this,26)||this;return i.m_apiTimings=t,i}return __extends(t,n),t}(WebViewerBaseInternalMessage),RecordStartedSlideShowTimestampInternalMessage=function(n){function t(t){var i=n.call(this,33)||this;return i.m_startSlideShowTime=t,i}return __extends(t,n),t}(WebViewerBaseInternalMessage),XhrRequest=function(){function n(){this.NumRetries=5;this.Timeout=0}return n.prototype.Abort=function(){this.Finished||(this.Finished=!0,this.Aborted=!0,this.CurrentRequest.abort())},n.prototype.Finish=function(n){this.Finished=!0;this.OnCompletedCallback(n)},n}(),XhrResponse=function(){function n(){}return n}(),XhrHelper=function(){function n(){}return n.GetBinary=function(n){this.GetWithRetries(n,0)},n.GetJson=function(n){this.GetWithRetries(n,0)},n.GetWithRetries=function(n,t){var r=this,i;if(!n.Url)throw Error("Url");if(n.ResponseType&&n.ResponseType!="arraybuffer"&&n.ResponseType!="blob")throw Error("ResponseType:"+n.ResponseType);i=new XMLHttpRequest;i.open("GET",n.Url,!0);i.timeout=n.Timeout;n.ResponseType&&(i.responseType=n.ResponseType);i.onreadystatechange=function(){i.readyState==4&&r.OnComplete(i,n,t)};i.send(null);n.CurrentRequest=i},n.OnComplete=function(n,t,i){var r=new XhrResponse,u;if(r.HttpStatusCode=n.status,r.State=t.State,r.RetriesUsed=i,r.Aborted=t.Aborted,r.FSuccess=!1,n.status!=200){!t.Aborted&&t.NumRetries>i&&n.status>=400&&n.status<500?this.GetWithRetries(t,i+1):t.Finish(r);return}t.ResponseType=="arraybuffer"||t.ResponseType=="blob"?r.Data=n.response:(r.Data=this.Deserialize(n.responseText),r.ResourceStringLength=n.responseText.length);u=n.getResponseHeader("Content-Length")?parseInt(n.getResponseHeader("Content-Length")):0;r.serverCorrelation=n.getResponseHeader("X-CorrelationId");r.ContentLength=u?u:0;r.FSuccess=!0;t.Finish(r)},n.Deserialize=function(n){if(n.substr(n.length-2,2)==");"){var t=n.indexOf("(")+1,i=n.length-2;n=n.substring(t,i)}return JSON.parse(n)},n}();